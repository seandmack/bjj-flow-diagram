<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BJJ Technique Flow Diagram</title>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;600;700&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-tertiary: #ffffff;
            --text-primary: #2d3748;
            --text-secondary: #718096;
            --text-tertiary: #a0aec0;
            --accent-gold: #F6A623;
            --accent-gold-dim: #d68a1a;
            --border-color: #e2e8f0;
            
            --color-position: #6B7280;
            --color-escape: #2B7F7F;
            --color-submission: #C75B5C;
            --color-sweep: #F6A623;
            --color-pass: #7DCBD4;
            --color-takedown: #F9D71C;
            --color-counter: #4A9B9B;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'DM Sans', sans-serif;
            background: #f8f9fa;
            color: var(--text-primary);
            overflow-x: hidden;
        }
        
        /* Header */
        header {
            background: white;
            border-bottom: 2px solid var(--border-color);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        h1 {
            font-family: 'Crimson Pro', serif;
            font-size: 1.75rem;
            font-weight: 700;
            letter-spacing: -0.02em;
            margin-bottom: 0.25rem;
            background: linear-gradient(135deg, var(--accent-gold) 0%, #f4d5a6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .subtitle {
            color: var(--text-secondary);
            font-size: 0.8rem;
            letter-spacing: 0.03em;
            text-transform: uppercase;
        }
        
        /* Controls */
        .controls {
            display: flex;
            gap: 0.75rem;
            align-items: center;
            margin-top: 1rem;
            flex-wrap: wrap;
        }
        
        .filter-group {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }
        
        .filter-label {
            color: var(--text-tertiary);
            font-size: 0.85rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-right: 0.5rem;
        }
        
        .filter-btn {
            padding: 0.5rem 1.2rem;
            background: white;
            border: 2px solid var(--border-color);
            color: var(--text-primary);
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: none;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .filter-btn:hover {
            border-color: var(--accent-gold);
        }
        
        .filter-btn.active {
            background: var(--accent-gold);
            border-color: var(--accent-gold);
            color: white;
        }
        
        .category-toggle {
            padding: 0.5rem 1.2rem;
            background: white;
            border: 2px solid var(--border-color);
            color: var(--text-primary);
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: none;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .category-toggle:hover {
            border-color: var(--accent-gold);
        }
        
        .category-toggle.active {
            background: var(--accent-gold);
            border-color: var(--accent-gold);
            color: white;
        }
        
        .category-toggle:not(.active) {
            opacity: 0.5;
        }
        
        /* Main Content */
        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 2rem;
        }
        
        #diagram-container {
            position: relative;
            background: var(--bg-secondary);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            overflow: hidden;
            margin-bottom: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }
        
        #flow-diagram {
            width: 100%;
            height: 3850px;
            background: white;
            cursor: grab;
        }
        
        #flow-diagram:active {
            cursor: grabbing;
        }
        
        /* Detail Views */
        .detail-view {
            display: none;
            background: white;
            border-radius: 12px;
            border: 2px solid var(--border-color);
            padding: 3rem;
            animation: fadeIn 0.4s ease;
        }
        
        .detail-view.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .detail-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 2rem;
            padding-bottom: 2rem;
            border-bottom: 2px solid var(--border-color);
        }
        
        .detail-title {
            font-family: 'Crimson Pro', serif;
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }
        
        .detail-category {
            display: inline-block;
            padding: 0.4rem 1rem;
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 20px;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            font-weight: 600;
            margin-top: 0.5rem;
            color: var(--text-primary);
        }
        
        .back-btn {
            padding: 0.75rem 1.5rem;
            background: white;
            border: 2px solid var(--border-color);
            color: var(--text-primary);
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: none;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .back-btn:hover {
            border-color: var(--accent-gold);
        }
        
        .detail-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
        }
        
        .detail-section {
            margin-bottom: 2rem;
        }
        
        .detail-section h3 {
            font-family: 'Crimson Pro', serif;
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--accent-gold);
        }
        
        .detail-section p,
        .detail-section li {
            color: var(--text-secondary);
            line-height: 1.8;
            font-size: 0.95rem;
        }
        
        .detail-section ul {
            list-style: none;
            padding-left: 0;
        }
        
        .detail-section ol {
            list-style: decimal;
            padding-left: 1.5rem;
        }
        
        .detail-section ol li {
            padding-left: 0.5rem;
        }
        
        .detail-section ol li:before {
            content: none;
        }
        
        .detail-section ul li {
            padding-left: 1.5rem;
            position: relative;
            margin-bottom: 0.75rem;
        }
        
        .detail-section ul li:before {
            content: "→";
            position: absolute;
            left: 0;
            color: var(--accent-gold);
            font-weight: 700;
        }
        
        .gif-container {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 1rem;
            border: 1px solid var(--border-color);
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .gif-container img {
            max-width: 100%;
            border-radius: 6px;
        }
        
        .gif-placeholder {
            padding: 4rem 2rem;
            color: var(--text-tertiary);
            font-style: italic;
        }
        
        /* D3 Styles */
        .node {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .node:hover {
            filter: brightness(1.2);
        }
        
        .node-circle {
            stroke-width: 2;
            stroke: var(--bg-primary);
        }
        
        .node-octagon {
            /* Stroke set inline for each node */
        }
        
        .node-rect {
            rx: 8;
            /* Stroke set inline for each node */
        }
        
        .node-text {
            font-size: 12px;
            font-weight: 600;
            pointer-events: none;
            text-anchor: middle;
            fill: var(--text-primary);
        }
        
        .position-text {
            fill: white;
            font-weight: 700;
        }
        
        .link {
            fill: none;
            stroke-width: 2;
            opacity: 0.5;
            transition: all 0.3s ease;
        }
        
        .link:hover {
            opacity: 0.8;
            stroke-width: 3;
        }
        
        .difficulty-badge {
            font-size: 10px;
            font-weight: 700;
        }
        
        .legend {
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            position: fixed;
            bottom: 2rem;
            right: 3rem;
            z-index: 100;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .legend h4 {
            font-family: 'Crimson Pro', serif;
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: var(--text-primary);
            font-weight: 700;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.5rem;
            font-size: 0.85rem;
        }
        
        .legend-color {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            border: 3px solid;
        }
        
        @media (max-width: 768px) {
            .detail-content {
                grid-template-columns: 1fr;
            }
            
            header {
                padding: 1.5rem;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .legend {
                position: static;
                margin-bottom: 1rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Brazilian Jiu-Jitsu Flow Diagram</h1>
        <p class="subtitle">Position Hierarchy & Technique Relationships</p>
        
        <div class="controls">
            <div class="filter-group">
                <span class="filter-label">Difficulty:</span>
                <button class="filter-btn active" data-filter="basic">Basic</button>
                <button class="filter-btn" data-filter="intermediate">Intermediate</button>
                <button class="filter-btn" data-filter="advanced">Advanced</button>
            </div>
            
            <div class="filter-group">
                <span class="filter-label">Categories:</span>
                <button class="category-toggle active" data-category="escape">Escapes</button>
                <button class="category-toggle active" data-category="counter">Counters</button>
                <button class="category-toggle active" data-category="submission">Submissions</button>
                <button class="category-toggle active" data-category="sweep">Sweeps</button>
                <button class="category-toggle active" data-category="pass">Passes</button>
                <button class="category-toggle active" data-category="takedown">Takedowns</button>
            </div>
        </div>
    </header>
    
    <div class="container">
        <!-- Legend -->
        <div class="legend">
            <h4>Categories</h4>
            <div class="legend-item">
                <div class="legend-color" style="background: white; border-color: var(--color-position)"></div>
                <span>Position</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: white; border-color: var(--color-escape)"></div>
                <span>Escape</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: white; border-color: var(--color-counter)"></div>
                <span>Counter</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: white; border-color: var(--color-submission)"></div>
                <span>Submission</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: white; border-color: var(--color-sweep)"></div>
                <span>Sweep</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: white; border-color: var(--color-pass)"></div>
                <span>Pass</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: white; border-color: var(--color-takedown)"></div>
                <span>Takedown</span>
            </div>
        </div>
        
        <!-- Flow Diagram -->
        <div id="diagram-container">
            <svg id="flow-diagram"></svg>
        </div>
        
        <!-- Position Detail View -->
        <div id="position-detail" class="detail-view">
            <div class="detail-header">
                <div>
                    <h2 class="detail-title" id="position-name"></h2>
                </div>
                <button class="back-btn" id="position-back-btn">← Back to Diagram</button>
            </div>
            
            <div class="detail-content">
                <div>
                    <div class="gif-container" id="position-gif"></div>
                    
                    <div class="detail-section">
                        <h3>Description</h3>
                        <p id="position-description"></p>
                    </div>
                </div>
                
                <div>
                    <div class="detail-section">
                        <h3>Objectives</h3>
                        <ul id="position-objectives"></ul>
                    </div>
                    
                    <div class="detail-section">
                        <h3>Key Points</h3>
                        <ul id="position-keypoints"></ul>
                    </div>
                    
                    <div class="detail-section">
                        <h3>Common Mistakes</h3>
                        <ul id="position-mistakes"></ul>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Technique Detail View -->
        <div id="technique-detail" class="detail-view">
            <div class="detail-header">
                <div>
                    <h2 class="detail-title" id="technique-name"></h2>
                    <span class="detail-category" id="technique-category"></span>
                    <span class="detail-category" id="technique-difficulty"></span>
                </div>
                <button class="back-btn" id="technique-back-btn">← Back to Diagram</button>
            </div>
            
            <div class="detail-content">
                <div>
                    <div class="gif-container" id="technique-gif"></div>
                    
                    <div class="detail-section">
                        <h3>Origin</h3>
                        <p id="technique-origin"></p>
                    </div>
                </div>
                
                <div>
                    <div class="detail-section">
                        <h3>Steps</h3>
                        <ol id="technique-steps"></ol>
                    </div>
                    
                    <div class="detail-section">
                        <h3>Key Points</h3>
                        <ul id="technique-keypoints"></ul>
                    </div>
                    
                    <div class="detail-section">
                        <h3>Common Mistakes</h3>
                        <ul id="technique-mistakes"></ul>
                    </div>
                    
                    <div class="detail-section">
                        <h3>Variations</h3>
                        <ul id="technique-variations"></ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <script>
        // Positions Data
        const positionsData = [
            {
                id: 'standing',
                name: 'Standing',
                y: 100,
                category: 'neutral',
                difficulty: 'intermediate',
                description: 'Neutral standing position where both competitors are on their feet, looking to establish grips and execute takedowns.',
                gifUrl: null,
                objectives: [
                    'Offensive: Establish dominant grips and execute takedowns',
                    'Offensive: Control distance and set up attacks',
                    'Defensive: Break opponent\'s grips and prevent takedowns',
                    'Defensive: Maintain balance and good posture'
                ],
                keyPoints: [
                    'Maintain good posture and balance',
                    'Control opponent\'s sleeves and collar',
                    'Stay mobile and reactive'
                ],
                commonMistakes: [
                    'Standing too upright or bent over',
                    'Allowing opponent dominant grips',
                    'Being flat-footed and static'
                ]
            },
            {
                id: 'mount',
                name: 'Mount',
                y: 450,
                category: 'top',
                difficulty: 'basic',
                description: 'Dominant position where you sit on your opponent\'s torso with your knees controlling their sides.',
                gifUrl: null,
                objectives: [
                    'Offensive (Top): Maintain chest-to-chest pressure and control',
                    'Offensive (Top): Set up submissions (armbar, americana, ezekiel)',
                    'Offensive (Top): Transition to higher positions (high mount, S-mount)',
                    'Defensive (Bottom): Create frames and space to escape',
                    'Defensive (Bottom): Trap arm and leg for bridge escape',
                    'Defensive (Bottom): Elbow-knee escape to recover guard'
                ],
                keyPoints: [
                    'Keep weight on opponent\'s chest',
                    'Maintain wide base with knees',
                    'Control opponent\'s arms and frames'
                ],
                commonMistakes: [
                    'Sitting too high allowing hip escape',
                    'Being too upright and losing balance',
                    'Not controlling opponent\'s frames'
                ]
            },
            {
                id: 'side-control',
                name: 'Side Control',
                y: 800,
                category: 'top',
                difficulty: 'basic',
                description: 'Perpendicular control position where you control opponent from the side with chest pressure.',
                gifUrl: null,
                objectives: [
                    'Offensive (Top): Apply heavy chest pressure and control',
                    'Offensive (Top): Set up submissions (kimura, americana, head-arm choke)',
                    'Offensive (Top): Transition to mount or back control',
                    'Defensive (Bottom): Create frames on hip and neck',
                    'Defensive (Bottom): Shrimp and recover guard',
                    'Defensive (Bottom): Prevent opponent from advancing position'
                ],
                keyPoints: [
                    'Distribute weight through chest',
                    'Control near arm and far hip',
                    'Keep hips low and heavy'
                ],
                commonMistakes: [
                    'Allowing space for frames',
                    'Weight too high on shoulders',
                    'Not controlling the hips'
                ]
            },
            {
                id: 'back-mount',
                name: 'Back Mount',
                y: 1150,
                category: 'top',
                difficulty: 'basic',
                description: 'Highest control position where you control opponent\'s back with hooks.',
                gifUrl: null,
                objectives: [
                    'Offensive (Top): Maintain seatbelt grip and hook control',
                    'Offensive (Top): Set up rear naked choke or bow and arrow',
                    'Offensive (Top): Prevent opponent from turning or escaping',
                    'Defensive (Bottom): Protect neck from chokes immediately',
                    'Defensive (Bottom): Clear hooks one at a time',
                    'Defensive (Bottom): Turn into opponent to recover guard'
                ],
                keyPoints: [
                    'Keep chest tight to opponent\'s back',
                    'Maintain hook control',
                    'Control opponent\'s head position'
                ],
                commonMistakes: [
                    'Allowing opponent to turn into you',
                    'Losing hook control',
                    'Not maintaining seatbelt grip'
                ]
            },
            {
                id: 'turtle',
                name: 'Turtle',
                y: 1500,
                category: 'defensive',
                difficulty: 'basic',
                description: 'Defensive position on hands and knees, protecting against submissions while looking to escape or counter.',
                gifUrl: null,
                objectives: [
                    'Offensive (Top): Break opponent down to take back',
                    'Offensive (Top): Attack with clock choke or crucifix',
                    'Offensive (Top): Force opponent to belly down or side',
                    'Defensive (Bottom): Protect neck and limbs from submissions',
                    'Defensive (Bottom): Create space to return to guard',
                    'Defensive (Bottom): Counter with sit-through or roll-through escapes'
                ],
                keyPoints: [
                    'Keep elbows tight to knees',
                    'Maintain strong base',
                    'Hide hands and arms'
                ],
                commonMistakes: [
                    'Staying flat and static',
                    'Exposing arms or neck',
                    'Not moving to escape'
                ]
            },
            {
                id: 'guard',
                name: 'Guard',
                y: 1850,
                category: 'bottom',
                difficulty: 'basic',
                description: 'Bottom position where you control opponent with legs locked around their waist.',
                gifUrl: null,
                objectives: [
                    'Offensive (Bottom): Break opponent\'s posture down',
                    'Offensive (Bottom): Set up sweeps (scissor, hip bump, flower)',
                    'Offensive (Bottom): Attack with submissions (triangle, armbar, guillotine)',
                    'Defensive (Top): Maintain good posture and base',
                    'Defensive (Top): Prevent sweeps and submissions',
                    'Defensive (Top): Open guard and pass to side control'
                ],
                keyPoints: [
                    'Keep ankles locked tightly',
                    'Pull opponent\'s head down',
                    'Control sleeves or collar'
                ],
                commonMistakes: [
                    'Allowing opponent to stand',
                    'Keeping guard too loose',
                    'Not breaking posture'
                ]
            },
            {
                id: 'open-guard',
                name: 'Open Guard',
                y: 2200,
                category: 'bottom',
                difficulty: 'basic',
                description: 'Guard position where legs are not locked, allowing for dynamic movement and various guard styles.',
                gifUrl: null,
                objectives: [
                    'Offensive (Bottom): Control opponent\'s posture and distance with feet',
                    'Offensive (Bottom): Create angles for sweeps and off-balancing',
                    'Offensive (Bottom): Transition to other guards (spider, de la riva, X-guard)',
                    'Defensive (Top): Maintain good posture and balance',
                    'Defensive (Top): Control opponent\'s legs and hips',
                    'Defensive (Top): Pass guard to side control or mount'
                ],
                keyPoints: [
                    'Use feet on hips, knees, or biceps',
                    'Maintain active grips',
                    'Stay mobile and adjust constantly'
                ],
                commonMistakes: [
                    'Being too passive',
                    'Allowing opponent to pin legs down',
                    'Not controlling distance'
                ]
            },
            {
                id: 'half-guard',
                name: 'Half Guard',
                y: 2550,
                category: 'bottom',
                difficulty: 'basic',
                description: 'Position where bottom player controls one of opponent\'s legs between their legs.',
                gifUrl: null,
                objectives: [
                    'Offensive (Bottom): Maintain underhook and prevent flattening',
                    'Offensive (Bottom): Create sweeping opportunities (old school, electric chair)',
                    'Offensive (Bottom): Recover full guard or take the back',
                    'Defensive (Top): Establish crossface and control',
                    'Defensive (Top): Pass to side control or mount',
                    'Defensive (Top): Prevent sweeps and back takes'
                ],
                keyPoints: [
                    'Maintain underhook control',
                    'Keep opponent off-balance',
                    'Control opponent\'s weight distribution'
                ],
                commonMistakes: [
                    'Being flat on back',
                    'Losing underhook battle',
                    'Allowing crossface control'
                ]
            },
            {
                id: 'x-guard',
                name: 'X-Guard',
                y: 2900,
                category: 'bottom',
                difficulty: 'intermediate',
                description: 'Advanced guard position where you control opponent\'s leg with both of your legs in an "X" formation.',
                gifUrl: null,
                objectives: [
                    'Offensive (Bottom): Off-balance opponent and control base',
                    'Offensive (Bottom): Execute sweeps to top position',
                    'Offensive (Bottom): Transition to single leg X or back take',
                    'Defensive (Top): Maintain posture and prevent being swept',
                    'Defensive (Top): Free trapped leg and pass guard',
                    'Defensive (Top): Create distance and disengage'
                ],
                keyPoints: [
                    'One foot on hip, other hooks behind knee',
                    'Control opponent\'s ankle or pant leg',
                    'Stay perpendicular to opponent'
                ],
                commonMistakes: [
                    'Not controlling the ankle',
                    'Being too square to opponent',
                    'Allowing opponent to step back'
                ]
            },
            {
                id: 'butterfly-guard',
                name: 'Butterfly Guard',
                y: 3250,
                category: 'bottom',
                difficulty: 'intermediate',
                description: 'Guard position where you sit up with hooks on opponent\'s inner thighs, using elevation and grips to sweep.',
                gifUrl: null,
                objectives: [
                    'Offensive (Bottom): Elevate opponent with hooks for sweeps',
                    'Offensive (Bottom): Control posture with sleeve and collar grips',
                    'Offensive (Bottom): Transition to other guards or back takes',
                    'Defensive (Top): Maintain low base and prevent elevation',
                    'Defensive (Top): Clear hooks and pass guard',
                    'Defensive (Top): Control opponent\'s head and arms'
                ],
                keyPoints: [
                    'Sit up with strong posture',
                    'Hooks on inner thighs',
                    'Control sleeves or underhooks'
                ],
                commonMistakes: [
                    'Lying back flat',
                    'Not maintaining hooks',
                    'Weak grip control'
                ]
            },
            {
                id: 'north-south',
                name: 'North-South',
                y: 3600,
                category: 'top',
                difficulty: 'intermediate',
                description: 'Top control position where you are perpendicular to opponent, chest-to-chest with heads pointing opposite directions.',
                gifUrl: null,
                objectives: [
                    'Offensive (Top): Control opponent\'s torso and prevent escape',
                    'Offensive (Top): Apply crushing chest pressure',
                    'Offensive (Top): Set up chokes and arm attacks',
                    'Offensive (Top): Transition to mount or side control',
                    'Defensive (Bottom): Create frames to make space',
                    'Defensive (Bottom): Hip escape to recover guard',
                    'Defensive (Bottom): Roll to turtle or scramble'
                ],
                keyPoints: [
                    'Chest-to-chest pressure',
                    'Control opponent\'s hips',
                    'Sprawl weight onto opponent',
                    'Head control or underhooks'
                ],
                commonMistakes: [
                    'Not maintaining chest pressure',
                    'Positioning too high or too low',
                    'Allowing opponent to create frames',
                    'Losing balance when opponent bridges'
                ]
            }
        ];

        // Techniques Data
        const techniquesData = [
            // Standing Takedowns
            {
                id: 'high-single-leg',
                name: 'High Single Leg',
                fromId: 'standing',
                category: 'takedown',
                difficulty: 'intermediate',
                offsetX: 400,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'Control opponent\'s wrist or collar with lead hand',
                    'Step in deep with penetration step',
                    'Drive shoulder into opponent\'s chest',
                    'Wrap and secure opponent\'s leg at thigh level',
                    'Elevate the leg while driving forward',
                    'Run the pipe or transition to finish'
                ],
                keyPoints: [
                    'Deep penetration step is critical',
                    'Head positioning - tight to opponent\'s chest',
                    'Capture leg high on the thigh, not at ankle',
                    'Maintain posture and drive through'
                ],
                commonMistakes: [
                    'Shooting from too far away',
                    'Poor head position allowing sprawl',
                    'Grabbing too low on the leg',
                    'Not staying on toes during drive'
                ],
                variations: ['Low single leg', 'Single leg to double leg', 'Single leg dump'],
                origin: 'standing'
            },
            {
                id: 'high-double-leg',
                name: 'High Double Leg',
                fromId: 'standing',
                category: 'takedown',
                difficulty: 'intermediate',
                offsetX: 400,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'Set up with grip fighting or feints',
                    'Change levels explosively with penetration step',
                    'Drive shoulder into opponent\'s hips',
                    'Wrap both arms around both legs',
                    'Lift and drive forward simultaneously',
                    'Run the opponent backward or trip to finish'
                ],
                keyPoints: [
                    'Level change must be explosive and deep',
                    'Head position - to the side, never in front',
                    'Hips forward, chest to opponent\'s thighs',
                    'Drive on toes with continuous forward pressure'
                ],
                commonMistakes: [
                    'Telegraphing the shot',
                    'Head down the middle (dangerous)',
                    'Reaching for legs without level change',
                    'Stopping forward drive too early'
                ],
                variations: ['Blast double', 'Double leg to single leg', 'Ankle pick'],
                origin: 'standing'
            },
            {
                id: 'ankle-pick-to-back',
                name: 'Ankle Pick to Back Take',
                fromId: 'standing',
                category: 'takedown',
                difficulty: 'advanced',
                offsetX: 550,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'Establish strong collar and sleeve grips',
                    'Use grips to create misdirection and off-balance opponent',
                    'Suddenly change levels and reach for far ankle',
                    'Pull ankle up and toward you while driving forward',
                    'As opponent falls forward, circle behind them',
                    'Secure back control with seatbelt and hooks'
                ],
                keyPoints: [
                    'Timing and misdirection are crucial - opponent must be off-balance',
                    'Grip manipulation creates the opening',
                    'Level change must be quick and explosive',
                    'Immediate transition to back as they fall',
                    'Maintain control throughout the movement'
                ],
                commonMistakes: [
                    'Telegraphing the ankle pick attempt',
                    'Reaching for ankle without proper setup',
                    'Poor timing - attempting when opponent is balanced',
                    'Not following through to secure the back',
                    'Losing grip control during transition'
                ],
                variations: ['Ankle pick to single leg', 'Inside ankle pick', 'Ankle pick to leg drag'],
                origin: 'standing'
            },
            // Mount Submissions
            {
                id: 'armbar-from-mount',
                name: 'Armbar from Mount',
                fromId: 'mount',
                category: 'submission',
                difficulty: 'basic',
                offsetX: 250,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: 'Armbar_from_Mount.gif',
                steps: [
                    'Control opponent\'s arm across their body',
                    'Swing leg over opponent\'s head',
                    'Fall back while controlling arm',
                    'Squeeze knees together and lift hips'
                ],
                keyPoints: [
                    'Keep opponent\'s thumb pointing up',
                    'Control opponent\'s wrist with both hands',
                    'Squeeze knees tightly together'
                ],
                commonMistakes: [
                    'Not controlling the wrist properly',
                    'Allowing opponent to stack',
                    'Insufficient hip pressure'
                ],
                variations: ['S-mount armbar', 'Gift wrap to armbar'],
                origin: 'mount'
            },
            {
                id: 'armbar-from-mount-posture-stack-defense',
                name: 'Posture & Stack Defense',
                fromId: 'armbar-from-mount',
                category: 'counter',
                difficulty: 'basic',
                offsetX: -250,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'Keep your arm bent - don\'t let them straighten it',
                    'Grab your own collar/gi with free hand for structure',
                    'Posture up and drive your shoulder into their chest/face',
                    'Stack your weight forward onto them',
                    'As they lose hip control, pull your arm free'
                ],
                keyPoints: [
                    'Prevention is key - act before they swing leg over',
                    'Keep trapped elbow bent at all costs',
                    'Use your weight, not just arm strength',
                    'If they get leg over, still maintain posture pressure'
                ],
                commonMistakes: [
                    'Waiting too long to react',
                    'Trying to pull straight back instead of stacking forward',
                    'Letting arm straighten'
                ],
                variations: [],
                origin: 'mount'
            },
            {
                id: 'armbar-from-mount-hitchhiker-roll',
                name: 'Hitchhiker Roll-Through',
                fromId: 'armbar-from-mount',
                category: 'counter',
                difficulty: 'intermediate',
                offsetX: -250,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'Turn your trapped arm\'s thumb toward your face (hitchhiker)',
                    'Pull elbow toward opposite hip while rotating thumb up',
                    'Bridge and roll toward your trapped arm side',
                    'Use momentum to roll through and land on top',
                    'Posture up in their guard or pass to side control'
                ],
                keyPoints: [
                    'Explosive movement required',
                    'Timing critical - must have some space',
                    'Roll uses entire body, not just arm',
                    'Can result in sweep to dominant position'
                ],
                commonMistakes: [
                    'Rolling without the hitchhiker grip first',
                    'Rolling too slowly without commitment',
                    'Not following through to top position'
                ],
                variations: [],
                origin: 'mount'
            },
            {
                id: 'armbar-from-mount-cartwheel-escape',
                name: 'Cartwheel Escape (Can Opener)',
                fromId: 'armbar-from-mount',
                category: 'counter',
                difficulty: 'advanced',
                offsetX: -250,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'Accept some hyperextension risk (this is defensive desperation)',
                    'With free hand, push on their near thigh',
                    'Cartwheel your legs over toward their head',
                    'Use momentum to create space and break their grip',
                    'Land in scramble position or turtle',
                    'Immediately work to recover guard or stand'
                ],
                keyPoints: [
                    'High risk - only when no other option',
                    'Requires explosive athleticism',
                    'Accept that arm may get damaged',
                    'Creates chaos that can favor athletic defenders',
                    'Professional competitors use this when behind on points'
                ],
                commonMistakes: [
                    'Using this before trying safer options',
                    'Insufficient explosion in the movement',
                    'Not protecting arm during the scramble',
                    'Failing to immediately improve position after escape'
                ],
                variations: [],
                origin: 'mount'
            },
            {
                id: 'americana',
                name: 'Americana',
                fromId: 'mount',
                category: 'submission',
                difficulty: 'basic',
                offsetX: 250,
                offsetY: -50,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'Control opponent\'s wrist near their head',
                    'Thread your arm under their elbow',
                    'Grip your own wrist (figure-four)',
                    'Drive elbow to mat while lifting their hand'
                ],
                keyPoints: [
                    'Keep opponent\'s elbow at 90 degrees',
                    'Apply pressure slowly and controlled',
                    'Maintain mount throughout'
                ],
                commonMistakes: [
                    'Attacking from too high position',
                    'Not securing proper angle',
                    'Losing mount while applying'
                ],
                variations: ['High mount americana', 'S-mount americana'],
                origin: 'mount'
            },
            {
                id: 'cross-collar-choke',
                name: 'Cross Collar Choke',
                fromId: 'mount',
                category: 'submission',
                difficulty: 'basic',
                offsetX: 250,
                offsetY: -100,
                gi: true,
                nogi: false,
                gifUrl: null,
                steps: [
                    'Control opponent\'s posture to prevent defensive frames',
                    'Reach deep across with one hand to grip opposite collar',
                    'Bring second hand over first to grip other collar',
                    'Pull hands apart while driving elbows down',
                    'Apply pressure with forearms against sides of neck'
                ],
                keyPoints: [
                    'First grip must be deep (four fingers inside)',
                    'Keep elbows tight and low',
                    'Use chest weight to prevent opponent sitting up',
                    'Choke comes from spreading collars, not pulling'
                ],
                commonMistakes: [
                    'Shallow first grip allows easy defense',
                    'Sitting up too high loses pressure',
                    'Pulling straight back instead of spreading',
                    'Not controlling opponent\'s arms first'
                ],
                variations: ['High mount cross collar', 'S-mount cross collar', 'Ezekiel from mount'],
                origin: 'mount'
            },
            {
                id: 'mounted-triangle',
                name: 'Mounted Triangle',
                fromId: 'mount',
                category: 'submission',
                difficulty: 'intermediate',
                offsetX: 400,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'From mount, isolate one of opponent\'s arms across their body',
                    'Slide knee up towards opponent\'s shoulder on trapped arm side',
                    'Thread leg over opponent\'s shoulder and behind their head',
                    'Lock triangle by placing ankle behind opposite knee',
                    'Fall to side while pulling opponent\'s head down',
                    'Squeeze knees together and extend hips for finish'
                ],
                keyPoints: [
                    'Arm isolation is critical before attempting',
                    'High mount makes the setup easier',
                    'Lock triangle tightly before falling to side',
                    'Angle adjustment improves finishing pressure',
                    'Can transition to armbar if opponent defends'
                ],
                commonMistakes: [
                    'Not isolating arm properly first',
                    'Locking triangle too loose',
                    'Falling to side too early',
                    'Not controlling opponent\'s posture',
                    'Poor angle after transition'
                ],
                variations: ['Mounted triangle to armbar', 'High mount triangle', 'S-mount triangle'],
                origin: 'mount'
            },
            {
                id: 'gift-wrap-crucifix',
                name: 'Gift Wrap to Crucifix',
                fromId: 'mount',
                category: 'submission',
                difficulty: 'advanced',
                offsetX: 550,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'From mount, trap opponent\'s arm behind their own back (gift wrap)',
                    'Maintain control of trapped arm with your arm',
                    'Slide to side control while keeping gift wrap',
                    'Thread your leg over opponent\'s trapped arm',
                    'Secure crucifix position with leg and arm control',
                    'Finish with rear naked choke or armbar on free arm'
                ],
                keyPoints: [
                    'Gift wrap must be secure before transitioning',
                    'Maintain constant pressure to prevent escape',
                    'Crucifix provides complete control of both arms',
                    'Multiple submission options available',
                    'Body positioning prevents opponent from rolling'
                ],
                commonMistakes: [
                    'Losing gift wrap during transition',
                    'Not securing leg position in crucifix',
                    'Allowing opponent to straighten trapped arm',
                    'Poor weight distribution letting them escape',
                    'Rushing submissions before position is secure'
                ],
                variations: ['Crucifix armbar', 'Crucifix rear naked choke', 'Gift wrap back take'],
                origin: 'mount'
            },
            // Mount Escapes
            {
                id: 'upa-escape',
                name: 'Upa Escape',
                fromId: 'mount',
                category: 'escape',
                difficulty: 'basic',
                offsetX: -250,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'Trap opponent\'s arm and leg on same side',
                    'Bridge explosively towards trapped side',
                    'Roll opponent over',
                    'Land in their guard'
                ],
                keyPoints: [
                    'Bridge at 45-degree angle',
                    'Keep traps secure throughout',
                    'Use hip explosion, not just shoulders'
                ],
                commonMistakes: [
                    'Bridging straight up instead of at angle',
                    'Not trapping arm and leg securely',
                    'Telegraphing the movement'
                ],
                variations: ['Upa to technical mount escape'],
                origin: 'mount'
            },
            {
                id: 'elbow-escape',
                name: 'Elbow Escape',
                fromId: 'mount',
                category: 'escape',
                difficulty: 'basic',
                offsetX: -250,
                offsetY: 50,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'Frame on opponent\'s hips with forearms',
                    'Shrimp hips out to one side',
                    'Insert knee shield',
                    'Recover to half or full guard'
                ],
                keyPoints: [
                    'Create space with frame before shrimping',
                    'Keep elbows tight to body',
                    'Move hips, not just shoulders'
                ],
                commonMistakes: [
                    'Trying to push opponent away',
                    'Not creating enough space initially',
                    'Forgetting to recover guard'
                ],
                variations: ['Elbow escape to butterfly guard'],
                origin: 'mount'
            },
            {
                id: 'heel-drag-escape',
                name: 'Heel Drag / Backdoor Escape',
                fromId: 'mount',
                category: 'escape',
                difficulty: 'basic',
                offsetX: -250,
                offsetY: 100,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'Bridge to create space and shift opponent\'s weight',
                    'Reach across and grab opponent\'s heel or ankle',
                    'Pull heel toward your hip while turning to side',
                    'Drag heel past your hip to escape mount',
                    'Recover to half guard or scramble to top'
                ],
                keyPoints: [
                    'Time the bridge when opponent posts',
                    'Strong grip on heel is essential',
                    'Turn body away as you drag the heel',
                    'Keep pulling until completely clear'
                ],
                commonMistakes: [
                    'Not bridging first to create space',
                    'Weak or shallow grip on heel',
                    'Not turning body enough',
                    'Stopping the drag too early'
                ],
                variations: ['Backdoor escape to leg lock', 'Heel drag to deep half guard'],
                origin: 'mount'
            },
            {
                id: 'mount-escape-to-leg-entanglement',
                name: 'Mount Escape to Leg Entanglement',
                fromId: 'mount',
                category: 'escape',
                difficulty: 'intermediate',
                offsetX: -400,
                offsetY: 150,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'Frame and create initial space with elbow-knee connection',
                    'As you shrimp out, thread your inside leg deep across opponent\'s leg',
                    'Secure outside ashi garami or 50/50 position with leg configuration',
                    'Control opponent\'s ankle and establish grips',
                    'Transition immediately to leg lock attack or sweep'
                ],
                keyPoints: [
                    'Timing is critical - enter as they post or shift weight',
                    'Leg must thread deep to prevent them pulling free',
                    'Maintain ankle control throughout transition',
                    'Go from defensive to offensive mindset immediately'
                ],
                commonMistakes: [
                    'Not creating enough initial space',
                    'Threading leg too shallow',
                    'Losing ankle control during transition',
                    'Being passive after entry instead of attacking'
                ],
                variations: ['Entry to 50/50', 'Entry to inside sankaku', 'Escape to single leg X'],
                origin: 'mount'
            },
            {
                id: 'granby-roll-escape',
                name: 'Granby Roll / Technical Stand-Up',
                fromId: 'mount',
                category: 'escape',
                difficulty: 'advanced',
                offsetX: -550,
                offsetY: 200,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'Create maximum frame on opponent\'s hips and chest',
                    'Explosively shrimp and tuck chin to chest',
                    'Roll backwards over your shoulder in granby motion',
                    'Post hand on mat as you invert and continue rolling',
                    'Come up to seated position or technical stand-up',
                    'Re-engage or create distance based on situation'
                ],
                keyPoints: [
                    'Requires flexibility and explosive power',
                    'Must commit fully to the roll',
                    'Keep body tight during inversion',
                    'Be prepared to scramble upon completion'
                ],
                commonMistakes: [
                    'Not creating enough space before rolling',
                    'Rolling too slowly or hesitantly',
                    'Poor head/neck positioning during roll',
                    'Not coming up ready to re-engage'
                ],
                variations: ['Granby to sit-up guard', 'Technical stand to wrestling stance', 'Granby to reverse de la riva'],
                origin: 'mount'
            },
            // Side Control Escapes
            {
                id: 'elbow-knee-escape',
                name: 'Elbow-Knee Escape',
                fromId: 'side-control',
                category: 'escape',
                difficulty: 'basic',
                offsetX: -250,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'Frame with bottom elbow on opponent\'s hip',
                    'Frame with top hand on opponent\'s neck or shoulder',
                    'Shrimp away explosively while maintaining frames',
                    'Insert bottom knee between you and opponent',
                    'Recover full guard or half guard'
                ],
                keyPoints: [
                    'Strong frames are critical',
                    'Shrimp powerfully, don\'t be slow',
                    'Create space before inserting knee',
                    'Keep opponent\'s weight off you'
                ],
                commonMistakes: [
                    'Weak or collapsed frames',
                    'Not creating enough space before knee insertion',
                    'Slow, telegraphed movement',
                    'Trying to force knee in without space'
                ],
                variations: ['Shrimp to half guard', 'Shrimp to full guard', 'Running escape'],
                origin: 'side-control'
            },
            {
                id: 'bridge-and-roll',
                name: 'Bridge and Roll',
                fromId: 'side-control',
                category: 'escape',
                difficulty: 'basic',
                offsetX: -250,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'Trap opponent\'s near arm with your arm',
                    'Trap opponent\'s near leg with your leg',
                    'Bridge explosively toward trapped side',
                    'Roll opponent over while maintaining traps',
                    'Come up on top in opponent\'s guard'
                ],
                keyPoints: [
                    'Both arm AND leg must be trapped',
                    'Bridge into opponent, not away',
                    'Explosive bridge is key',
                    'Turn your head toward opponent during bridge'
                ],
                commonMistakes: [
                    'Not trapping both limbs',
                    'Weak or slow bridge',
                    'Bridging away from opponent',
                    'Releasing traps during the roll'
                ],
                variations: ['Upa from mount', 'Bridge to half guard'],
                origin: 'side-control'
            },
            {
                id: 'ghost-escape',
                name: 'Ghost Escape',
                fromId: 'side-control',
                category: 'escape',
                difficulty: 'intermediate',
                offsetX: -400,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'Frame on opponent\'s neck and hip',
                    'Shrimp away explosively',
                    'Get to your side facing opponent',
                    'Recover guard or scramble to top'
                ],
                keyPoints: [
                    'Create maximum distance with shrimp',
                    'Keep frames strong',
                    'Move explosively, not slowly'
                ],
                commonMistakes: [
                    'Not creating enough initial space',
                    'Weak frames allowing recapture',
                    'Moving too slowly'
                ],
                variations: ['Ghost escape to x-guard'],
                origin: 'side-control'
            },
            {
                id: 'granby-roll-escape',
                name: 'Granby Roll Escape',
                fromId: 'side-control',
                category: 'escape',
                difficulty: 'advanced',
                offsetX: -550,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'Create initial space with frame or underhook',
                    'Turn toward opponent and tuck chin to chest',
                    'Roll backwards over your shoulder diagonally',
                    'Use momentum to complete roll and face opponent',
                    'Recover guard or reverse position'
                ],
                keyPoints: [
                    'Timing and momentum are critical',
                    'Roll over shoulder, not directly back',
                    'Protect your neck during roll',
                    'Use opponent\'s pressure against them',
                    'Stay tight throughout the roll'
                ],
                commonMistakes: [
                    'Rolling at wrong angle (too straight back)',
                    'Not creating initial space first',
                    'Slow execution without commitment',
                    'Leaving neck exposed',
                    'Not following through to complete the roll'
                ],
                variations: ['Granby to reverse de la riva', 'Granby to technical standup', 'Granby to sit-up guard'],
                origin: 'side-control'
            },
            // Side Control Submissions
            {
                id: 'americana-from-side',
                name: 'Americana from Side',
                fromId: 'side-control',
                category: 'submission',
                difficulty: 'basic',
                offsetX: 250,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'Control opponent\'s near-side wrist',
                    'Slide arm under their elbow',
                    'Grip your own wrist (figure-four)',
                    'Pin their wrist to mat and lift elbow',
                    'Apply pressure by rotating arm toward their head'
                ],
                keyPoints: [
                    'Keep their wrist pinned to the mat',
                    'Maintain side control pressure throughout',
                    'Elbow stays at 90-degree angle',
                    'Rotate slowly and controlled'
                ],
                commonMistakes: [
                    'Losing side control position',
                    'Allowing wrist to come off mat',
                    'Not controlling opponent\'s other arm',
                    'Forcing the submission too fast'
                ],
                variations: ['Americana from mount', 'Americana from knee on belly'],
                origin: 'side-control'
            },
            {
                id: 'paper-cutter-choke',
                name: 'Paper Cutter Choke',
                fromId: 'side-control',
                category: 'submission',
                difficulty: 'basic',
                offsetX: 250,
                offsetY: 0,
                gi: true,
                nogi: false,
                gifUrl: null,
                steps: [
                    'Secure deep cross-collar grip with four fingers in',
                    'Drive your forearm blade across opponent\'s throat',
                    'Post your other hand on mat for base',
                    'Apply pressure by pulling gi and driving shoulder',
                    'Maintain side control pressure throughout'
                ],
                keyPoints: [
                    'Grip must be deep (palm up, fingers in)',
                    'Blade of forearm creates the choke',
                    'Keep your weight on opponent',
                    'Shoulder pressure helps finish'
                ],
                commonMistakes: [
                    'Shallow collar grip',
                    'Rising up too high',
                    'Not using shoulder pressure',
                    'Allowing opponent to turn into you'
                ],
                variations: ['Baseball bat choke', 'Bow and arrow from side'],
                origin: 'side-control'
            },
            {
                id: 'kimura-from-side',
                name: 'Kimura from Side',
                fromId: 'side-control',
                category: 'submission',
                difficulty: 'intermediate',
                offsetX: 400,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'Isolate opponent\'s far arm',
                    'Thread your arm under their elbow',
                    'Grip your own wrist (figure-four)',
                    'Lift arm up and towards their head'
                ],
                keyPoints: [
                    'Control opponent\'s wrist throughout',
                    'Keep their elbow tight to their body',
                    'Apply pressure in controlled manner'
                ],
                commonMistakes: [
                    'Allowing opponent to straighten arm',
                    'Not securing proper grip',
                    'Forcing submission too quickly'
                ],
                variations: ['Kimura to back take', 'Kimura sweep'],
                origin: 'side-control'
            },
            {
                id: 'japanese-necktie',
                name: 'Japanese Necktie',
                fromId: 'side-control',
                category: 'submission',
                difficulty: 'advanced',
                offsetX: 550,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'From side control, secure opponent\'s far arm with overhook',
                    'Thread your other arm under their head and around neck',
                    'Grip your own wrist or forearm (arm wrap)',
                    'Roll opponent toward you while maintaining wrap',
                    'Come up on top as they roll',
                    'Squeeze arms together and drive shoulder into head'
                ],
                keyPoints: [
                    'Arm wrap must be deep around neck',
                    'Timing the roll is critical',
                    'Maintain tight control during roll',
                    'Finish on top with shoulder pressure',
                    'Squeeze both arms together for choke'
                ],
                commonMistakes: [
                    'Shallow grip on neck',
                    'Not committing to the roll',
                    'Losing control mid-transition',
                    'Not using shoulder pressure to finish',
                    'Rolling too early before securing grips'
                ],
                variations: ['Japanese necktie from turtle', 'Darce choke variation'],
                origin: 'side-control'
            },
            // Closed Guard Sweeps
            {
                id: 'scissor-sweep',
                name: 'Scissor Sweep',
                fromId: 'guard',
                category: 'sweep',
                difficulty: 'basic',
                offsetX: 250,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'Break opponent\'s posture down',
                    'Open guard and place shin across their stomach',
                    'Control sleeve and collar',
                    'Scissor legs while pulling with grips'
                ],
                keyPoints: [
                    'Bottom leg hooks behind knee',
                    'Top leg pushes across midsection',
                    'Pull opponent forward as you scissor'
                ],
                commonMistakes: [
                    'Not breaking posture first',
                    'Weak scissoring motion',
                    'Poor grip control'
                ],
                variations: ['Flower sweep', 'Lumberjack sweep'],
                origin: 'guard'
            },
            {
                id: 'hip-bump-sweep',
                name: 'Hip Bump Sweep',
                fromId: 'guard',
                category: 'sweep',
                difficulty: 'basic',
                offsetX: 250,
                offsetY: -50,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'Sit up and post hand behind you',
                    'Wrap other arm around opponent\'s back',
                    'Bump opponent with your hip',
                    'Drive forward to mount'
                ],
                keyPoints: [
                    'Get head to side of opponent\'s head',
                    'Strong hip bump with extension',
                    'Drive through to complete sweep'
                ],
                commonMistakes: [
                    'Not sitting up high enough',
                    'Weak hip bump',
                    'Not driving through finish'
                ],
                variations: ['Hip bump to kimura', 'Hip bump to guillotine'],
                origin: 'guard'
            },
            // Closed Guard Submissions
            {
                id: 'guillotine-choke',
                name: 'Guillotine Choke',
                fromId: 'guard',
                category: 'submission',
                difficulty: 'basic',
                offsetX: 250,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'When opponent dives forward, wrap arm around their neck',
                    'Lock hands together (palm to palm or palm to wrist)',
                    'Close guard and pull opponent\'s head down',
                    'Lift hips and arch back while squeezing',
                    'Drive choking arm forearm into throat'
                ],
                keyPoints: [
                    'Get forearm deep across throat',
                    'Lock hands tightly together',
                    'Pull head down with guard closed',
                    'Lift hips to increase pressure',
                    'Squeeze forearm into throat, not just pull'
                ],
                commonMistakes: [
                    'Shallow arm position on neck',
                    'Weak hand lock',
                    'Not using hips to lift',
                    'Pulling head instead of squeezing forearm',
                    'Allowing opponent to posture up'
                ],
                variations: ['High guard guillotine', 'Arm-in guillotine', 'Standing guillotine'],
                origin: 'guard'
            },
            {
                id: 'kimura-from-guard',
                name: 'Kimura from Guard',
                fromId: 'guard',
                category: 'submission',
                difficulty: 'basic',
                offsetX: 250,
                offsetY: 50,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'From closed guard, control opponent\'s wrist',
                    'Open guard and bring leg over their shoulder',
                    'Thread your arm under their elbow',
                    'Grip your own wrist (figure-four)',
                    'Control their shoulder with your leg',
                    'Apply pressure by lifting their arm toward their head'
                ],
                keyPoints: [
                    'Secure wrist control first',
                    'Figure-four grip must be tight',
                    'Use leg to control their posture',
                    'Apply pressure slowly and controlled',
                    'Keep their arm at 90-degree angle'
                ],
                commonMistakes: [
                    'Losing wrist control',
                    'Not securing proper figure-four grip',
                    'Allowing opponent to posture up',
                    'Forcing submission too quickly',
                    'Not using leg to control shoulder'
                ],
                variations: ['Kimura to sweep', 'Kimura to back take', 'Reverse kimura'],
                origin: 'guard'
            },
            {
                id: 'triangle-choke',
                name: 'Triangle Choke',
                fromId: 'guard',
                category: 'submission',
                difficulty: 'intermediate',
                offsetX: 400,
                offsetY: 50,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'Control one arm in, one arm out',
                    'Pivot hips and throw leg over shoulder',
                    'Lock triangle with legs',
                    'Pull opponent\'s head down and squeeze'
                ],
                keyPoints: [
                    'Cut angle before locking triangle',
                    'Lock ankle behind knee, not calf',
                    'Squeeze knees together while pulling head'
                ],
                commonMistakes: [
                    'Not isolating arm properly',
                    'Locking triangle too early',
                    'Not cutting proper angle'
                ],
                variations: ['Armbar from triangle', 'Omoplata from triangle'],
                origin: 'guard'
            },
            {
                id: 'omoplata',
                name: 'Omoplata',
                fromId: 'guard',
                category: 'submission',
                difficulty: 'intermediate',
                offsetX: 400,
                offsetY: 100,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'From guard, isolate opponent\'s arm',
                    'Pivot hips and swing leg over their shoulder',
                    'Control their arm with your leg',
                    'Sit up and control their waist',
                    'Extend their arm and lean forward',
                    'Apply shoulder lock by driving forward'
                ],
                keyPoints: [
                    'Deep hip pivot is essential',
                    'Control opponent\'s arm throughout',
                    'Sit up completely before finishing',
                    'Control their waist to prevent roll',
                    'Lean forward to apply pressure'
                ],
                commonMistakes: [
                    'Not pivoting hips enough',
                    'Losing arm control',
                    'Not sitting up fully',
                    'Allowing opponent to roll forward',
                    'Applying pressure before securing position'
                ],
                variations: ['Omoplata to sweep', 'Omoplata to back take', 'Rolling omoplata'],
                origin: 'guard'
            },
            {
                id: 'gogoplata',
                name: 'Gogoplata',
                fromId: 'guard',
                category: 'submission',
                difficulty: 'advanced',
                offsetX: 550,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'From high guard, break opponent\'s posture down',
                    'Bring one leg over opponent\'s shoulder and back',
                    'Thread your shin across their throat',
                    'Pull their head down with both hands',
                    'Drive shin into throat while pulling head',
                    'Apply pressure by extending leg and pulling head'
                ],
                keyPoints: [
                    'Requires excellent flexibility',
                    'Must break posture completely',
                    'Shin placement across throat is critical',
                    'Use both hands to pull head down',
                    'Combination of shin pressure and head pull',
                    'Keep opponent tight to your body'
                ],
                commonMistakes: [
                    'Not flexible enough to execute properly',
                    'Allowing opponent to posture up',
                    'Poor shin placement on throat',
                    'Not pulling head down enough',
                    'Losing control during setup',
                    'Attempting without proper flexibility'
                ],
                variations: ['Locoplata (using hand instead of shin)', 'Ezekiel from guard', 'Gogoplata from rubber guard'],
                origin: 'guard'
            },
            {
                id: 'flower-sweep',
                name: 'Flower Sweep',
                fromId: 'guard',
                category: 'sweep',
                difficulty: 'basic',
                offsetX: 250,
                offsetY: 100,
                gi: true,
                nogi: false,
                gifUrl: null,
                steps: [
                    'Control opponent\'s sleeve and collar',
                    'Open guard and hook opponent\'s leg with your foot',
                    'Pull opponent forward while sweeping the leg',
                    'Come up to mount or top position'
                ],
                keyPoints: [
                    'Strong collar and sleeve grips',
                    'Hook deep behind opponent\'s knee',
                    'Pull opponent\'s weight forward as you sweep'
                ],
                commonMistakes: [
                    'Not controlling the posture',
                    'Shallow leg hook',
                    'Not pulling opponent forward enough'
                ],
                variations: ['Pendulum sweep', 'Modified flower sweep'],
                origin: 'guard'
            },
            // Guard Passes/Escapes (from top)
            {
                id: 'standing-guard-break',
                name: 'Standing Guard Break',
                fromId: 'guard',
                category: 'pass',
                difficulty: 'basic',
                offsetX: -250,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'Control opponent\'s sleeves or collar',
                    'Post one foot on opponent\'s hip',
                    'Stand up while maintaining grips',
                    'Break grip on second leg and stand fully',
                    'Control opponent\'s legs/pants',
                    'Open guard by creating distance or pushing knee'
                ],
                keyPoints: [
                    'Maintain good posture throughout',
                    'Break grips systematically',
                    'Control opponent\'s hips/legs after standing',
                    'Don\'t rush - stand with control',
                    'Keep hands active to prevent sweeps'
                ],
                commonMistakes: [
                    'Standing without controlling grips',
                    'Poor posture allows opponent to break you down',
                    'Not controlling legs after standing',
                    'Standing too close or too far',
                    'Getting swept during stand-up'
                ],
                variations: ['Standing pass to knee slice', 'Standing pass to toreando'],
                origin: 'guard'
            },
            {
                id: 'knee-slice-pass',
                name: 'Knee Slice Pass',
                fromId: 'guard',
                category: 'pass',
                difficulty: 'basic',
                offsetX: -250,
                offsetY: 50,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'Open guard and control opponent\'s legs',
                    'Drive knee across opponent\'s belly',
                    'Keep weight low and forward',
                    'Slide knee through while blocking far hip',
                    'Bring other leg over and establish side control',
                    'Secure crossface and underhook'
                ],
                keyPoints: [
                    'Pressure is key - stay heavy',
                    'Block opponent\'s hip with your hand',
                    'Knee cuts across belly, not over legs',
                    'Keep head low and tight',
                    'Don\'t let opponent recover guard'
                ],
                commonMistakes: [
                    'Not enough forward pressure',
                    'Knee too high allows easy defense',
                    'Not blocking opponent\'s hip',
                    'Poor head position',
                    'Allowing opponent to get frames'
                ],
                variations: ['Knee slice to mount', 'Knee slice to north-south'],
                origin: 'guard'
            },
            {
                id: 'toreando-pass',
                name: 'Toreando Pass (Bullfighter)',
                fromId: 'guard',
                category: 'pass',
                difficulty: 'basic',
                offsetX: -250,
                offsetY: 100,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'Control both of opponent\'s ankles or pant legs',
                    'Stand with good posture',
                    'Push opponent\'s legs to one side',
                    'Step around to opposite side',
                    'Keep opponent\'s legs controlled',
                    'Establish side control or knee on belly'
                ],
                keyPoints: [
                    'Strong grip on legs/pants',
                    'Push legs away explosively',
                    'Circle around quickly',
                    'Keep opponent\'s hips on ground',
                    'Don\'t let opponent face you'
                ],
                commonMistakes: [
                    'Weak leg control',
                    'Not moving legs far enough to side',
                    'Stepping too slow',
                    'Allowing opponent to square up',
                    'Losing control of legs mid-pass'
                ],
                variations: ['Double under pass', 'Toreando to back take'],
                origin: 'guard'
            },
            {
                id: 'x-pass',
                name: 'X-Pass (Leg Weave)',
                fromId: 'guard',
                category: 'pass',
                difficulty: 'intermediate',
                offsetX: -400,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'From standing or combat base, control one leg',
                    'Weave your leg under opponent\'s leg',
                    'Drive your weight forward and down',
                    'Pin opponent\'s leg to ground with your leg',
                    'Swim for underhook or crossface',
                    'Complete pass to side control'
                ],
                keyPoints: [
                    'Leg weave must be deep',
                    'Forward pressure is critical',
                    'Pin opponent\'s leg effectively',
                    'Don\'t give them space to recover',
                    'Control upper body during transition'
                ],
                commonMistakes: [
                    'Shallow leg weave',
                    'Not enough forward pressure',
                    'Poor weight distribution',
                    'Allowing opponent to create frames',
                    'Not securing upper body control',
                    'Getting swept during pass'
                ],
                variations: ['X-pass to mount', 'X-pass to knee on belly', 'Reverse X-pass'],
                origin: 'guard'
            },
            {
                id: 'cartwheel-pass',
                name: 'Cartwheel Pass',
                fromId: 'guard',
                category: 'pass',
                difficulty: 'advanced',
                offsetX: -550,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'From standing over guard, control opponent\'s legs',
                    'Create distance and angle for cartwheel',
                    'Plant hand on mat near opponent\'s hip',
                    'Cartwheel explosively over opponent',
                    'Land with weight on opponent\'s upper body',
                    'Secure side control or back position',
                    'Establish dominant grips immediately'
                ],
                keyPoints: [
                    'Requires athleticism and timing',
                    'Must control opponent\'s legs first',
                    'Explosive movement is essential',
                    'Land with pressure and control',
                    'Be ready to defend counters',
                    'Commit fully to the movement'
                ],
                commonMistakes: [
                    'Not controlling legs before cartwheeling',
                    'Hesitating mid-cartwheel',
                    'Poor hand placement',
                    'Landing without control or pressure',
                    'Not securing position immediately',
                    'Telegraphing the movement',
                    'Insufficient explosiveness'
                ],
                variations: ['Cartwheel to back take', 'Cartwheel to mount', 'Cartwheel counter to berimbolo'],
                origin: 'guard'
            },
            // Open Guard Passes/Escapes (from top)
            {
                id: 'combat-base-standing',
                name: 'Combat Base to Standing',
                fromId: 'open-guard',
                category: 'pass',
                difficulty: 'basic',
                offsetX: -250,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'From inside open guard, establish combat base position',
                    'One knee up, one knee down with good posture',
                    'Control opponent\'s grips on your sleeves or collar',
                    'Post on opponent\'s hips or thighs',
                    'Stand up while maintaining grip control',
                    'Create distance and begin pass'
                ],
                keyPoints: [
                    'Strong base prevents sweeps',
                    'Maintain good posture throughout',
                    'Control opponent\'s grips before standing',
                    'Keep elbows in tight',
                    'Don\'t rush - stand with control'
                ],
                commonMistakes: [
                    'Poor posture allows guard player to attack',
                    'Standing without controlling grips',
                    'Weak base during transition',
                    'Hands too far from body',
                    'Not creating proper distance after standing'
                ],
                variations: ['Standing to knee cut', 'Standing to leg drag', 'Standing to toreando'],
                origin: 'open-guard'
            },
            {
                id: 'over-under-pass',
                name: 'Over-Under Pass',
                fromId: 'open-guard',
                category: 'pass',
                difficulty: 'intermediate',
                offsetX: -400,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'From open guard, control one leg over with arm',
                    'Thread other arm under opponent\'s other leg',
                    'Lock hands together behind opponent',
                    'Drive forward and stack opponent\'s weight',
                    'Walk legs to side while maintaining pressure',
                    'Complete pass to side control'
                ],
                keyPoints: [
                    'Hands must be locked tightly together',
                    'Drive forward with chest pressure',
                    'Stack opponent to limit movement',
                    'Walk your legs around methodically',
                    'Keep head tight to opponent\'s body',
                    'Don\'t give space for them to recover'
                ],
                commonMistakes: [
                    'Not locking hands properly',
                    'Insufficient forward pressure',
                    'Head position too far from body',
                    'Allowing opponent to create frames',
                    'Not stacking enough',
                    'Moving legs too quickly without control'
                ],
                variations: ['Over-under to mount', 'Over-under to knee on belly', 'Stack pass variation'],
                origin: 'open-guard'
            },
            {
                id: 'backflip-pass',
                name: 'Backflip Pass',
                fromId: 'open-guard',
                category: 'pass',
                difficulty: 'advanced',
                offsetX: -550,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'From standing over open guard, control opponent\'s legs',
                    'Create explosive setup and timing',
                    'Plant hands near opponent\'s hips',
                    'Explosively backflip over opponent',
                    'Land on other side with control',
                    'Immediately establish side control or back position',
                    'Secure dominant grips'
                ],
                keyPoints: [
                    'Requires exceptional athleticism and timing',
                    'Must control legs before flipping',
                    'Explosive power is essential',
                    'Commit fully to the movement',
                    'Land with immediate control',
                    'Be ready to defend counters'
                ],
                commonMistakes: [
                    'Not controlling legs first',
                    'Hesitating during the flip',
                    'Poor hand placement',
                    'Insufficient explosiveness',
                    'Landing without control',
                    'Not securing position immediately',
                    'Telegraphing the movement'
                ],
                variations: ['Backflip to mount', 'Backflip to back take', 'Backflip counter to berimbolo'],
                origin: 'open-guard'
            },
            // Open Guard Submissions
            {
                id: 'armbar-from-open-guard',
                name: 'Armbar from Open Guard',
                fromId: 'open-guard',
                category: 'submission',
                difficulty: 'basic',
                offsetX: 250,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'From open guard, establish grips on opponent\'s sleeve and collar',
                    'Break opponent\'s posture by pulling them down',
                    'Control opponent\'s arm across your body',
                    'Swing leg over opponent\'s head',
                    'Fall back while maintaining arm control',
                    'Squeeze knees together, keep thumb up, lift hips'
                ],
                keyPoints: [
                    'Break posture before attempting armbar',
                    'Control the wrist with both hands',
                    'Leg must go high over shoulder/head',
                    'Keep opponent\'s thumb pointing up',
                    'Squeeze knees tightly together',
                    'Lift hips to apply pressure'
                ],
                commonMistakes: [
                    'Not breaking posture first',
                    'Losing wrist control',
                    'Leg placement too low',
                    'Not controlling opponent\'s posture',
                    'Weak knee squeeze',
                    'Not lifting hips to finish'
                ],
                variations: ['Armbar from spider guard', 'Armbar from De La Riva', 'Armbar to triangle'],
                origin: 'open-guard'
            },
            {
                id: 'triangle-from-open-guard',
                name: 'Triangle from Open Guard',
                fromId: 'open-guard',
                category: 'submission',
                difficulty: 'intermediate',
                offsetX: 400,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'From open guard, establish grips and control posture',
                    'Create one arm in, one arm out position',
                    'Break opponent\'s posture down',
                    'Pivot hips to create angle',
                    'Throw leg over opponent\'s shoulder and back',
                    'Lock triangle by placing ankle behind knee',
                    'Pull opponent\'s head down and squeeze knees together'
                ],
                keyPoints: [
                    'Must isolate one arm across body',
                    'Break posture before attempting triangle',
                    'Cut proper angle - don\'t go straight on',
                    'Lock ankle behind knee, not on calf',
                    'Pull head down while squeezing knees',
                    'Adjust angle if choke not tight'
                ],
                commonMistakes: [
                    'Not isolating arm properly',
                    'Poor angle - staying square to opponent',
                    'Locking triangle too early without angle',
                    'Not breaking posture down',
                    'Weak knee squeeze',
                    'Not pulling head to tighten choke',
                    'Locking on calf instead of behind knee'
                ],
                variations: ['Triangle from spider guard', 'Triangle from De La Riva', 'Triangle to armbar', 'Triangle to omoplata'],
                origin: 'open-guard'
            },
            {
                id: 'rolling-kneebar',
                name: 'Rolling Kneebar',
                fromId: 'open-guard',
                category: 'submission',
                difficulty: 'advanced',
                offsetX: 550,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'From open guard, control opponent\'s leg (ankle or knee)',
                    'Create angle and space for the roll',
                    'Fall to your back while maintaining leg control',
                    'Roll backwards over your shoulder',
                    'Come up on top with opponent\'s leg trapped',
                    'Position leg across your hips with knee isolated',
                    'Secure figure-four grip and apply pressure by arching back'
                ],
                keyPoints: [
                    'Requires timing, flexibility, and commitment',
                    'Must maintain leg control throughout roll',
                    'Roll over shoulder, not straight back',
                    'Knee must be isolated above your hip',
                    'Control opponent\'s ankle/foot',
                    'Arch back to apply pressure, not just pull'
                ],
                commonMistakes: [
                    'Losing leg control during roll',
                    'Poor rolling technique',
                    'Not isolating the knee properly',
                    'Forcing kneebar without proper position',
                    'Rolling at wrong angle',
                    'Not maintaining figure-four grip',
                    'Pulling instead of arching to finish'
                ],
                variations: ['Rolling kneebar from 50/50', 'Rolling kneebar from De La Riva', 'Kneebar from leg drag defense'],
                origin: 'open-guard'
            },
            // Half Guard Passes/Escapes (from top)
            {
                id: 'knee-slice-half-guard',
                name: 'Knee Slice from Half Guard',
                fromId: 'half-guard',
                category: 'pass',
                difficulty: 'basic',
                offsetX: -250,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'From top of half guard, establish good base',
                    'Control opponent\'s upper body with crossface or underhook',
                    'Free your trapped leg by creating space',
                    'Drive your knee across opponent\'s legs',
                    'Keep weight forward and low',
                    'Slide knee through to side control',
                    'Secure crossface and underhook'
                ],
                keyPoints: [
                    'Crossface is critical for control',
                    'Keep weight heavy and forward',
                    'Drive knee across belly, not over legs',
                    'Block opponent\'s hip with hand',
                    'Don\'t let them recover full guard',
                    'Maintain shoulder pressure throughout'
                ],
                commonMistakes: [
                    'Not establishing upper body control first',
                    'Rising up too high',
                    'Not blocking opponent\'s hip',
                    'Allowing opponent to get underhook',
                    'Knee too high - should be low and tight',
                    'Not maintaining pressure during pass'
                ],
                variations: ['Knee slice to mount', 'Knee slice to knee on belly'],
                origin: 'half-guard'
            },
            {
                id: 'leg-weave-pass-half',
                name: 'Leg Weave Pass',
                fromId: 'half-guard',
                category: 'pass',
                difficulty: 'intermediate',
                offsetX: -400,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'From top of half guard, establish strong base',
                    'Weave your trapped leg under opponent\'s bottom leg',
                    'Drive your weight forward and down',
                    'Use your leg to pry their legs apart',
                    'Continue driving forward pressure',
                    'Free your leg completely',
                    'Complete pass to side control'
                ],
                keyPoints: [
                    'Leg weave must be deep',
                    'Forward pressure is essential',
                    'Use your leg as a wedge',
                    'Control upper body during pass',
                    'Keep opponent flat',
                    'Don\'t allow them to come to their side'
                ],
                commonMistakes: [
                    'Shallow leg weave',
                    'Not enough forward pressure',
                    'Allowing opponent to get on their side',
                    'Poor upper body control',
                    'Rising up instead of driving down',
                    'Not following through to complete pass'
                ],
                variations: ['Leg weave to mount', 'Leg weave with underhook'],
                origin: 'half-guard'
            },
            {
                id: 'coyote-half-pass',
                name: 'Coyote Half Guard Pass',
                fromId: 'half-guard',
                category: 'pass',
                difficulty: 'advanced',
                offsetX: -550,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'From top of half guard, establish tripod position',
                    'Post both hands on mat with hips high',
                    'Create explosive movement toward opponent\'s head',
                    'Dive your body over opponent\'s half guard',
                    'Land with chest on opponent\'s upper body',
                    'Take back control or establish side control',
                    'Secure dominant position immediately'
                ],
                keyPoints: [
                    'Requires timing, athleticism, and explosiveness',
                    'Tripod base must be stable first',
                    'Dive toward their head, not away',
                    'Commit fully to the movement',
                    'Land with immediate control',
                    'Multiple finish options (back, side, mount)'
                ],
                commonMistakes: [
                    'Poor initial base position',
                    'Hesitating during the dive',
                    'Diving at wrong angle',
                    'Not committing to the movement',
                    'Landing without control',
                    'Not securing position immediately',
                    'Telegraphing the movement'
                ],
                variations: ['Coyote to back take', 'Coyote to mount', 'Modified coyote pass'],
                origin: 'half-guard'
            },
            // Half Guard Submissions
            {
                id: 'kimura-from-half-guard',
                name: 'Kimura from Half Guard',
                fromId: 'half-guard',
                category: 'submission',
                difficulty: 'basic',
                offsetX: 250,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'From half guard bottom, secure underhook on opponent',
                    'Reach over and grab opponent\'s far wrist',
                    'Thread your underhook arm under their elbow',
                    'Lock figure-four grip (your wrist)',
                    'Use kimura grip to sweep or submit',
                    'If they defend, transition to old school or come to dog fight'
                ],
                keyPoints: [
                    'Underhook first, then attack kimura',
                    'Control their posture with the grip',
                    'Can be used as sweep setup',
                    'Figure-four must be tight',
                    'Use to prevent being flattened',
                    'Multiple options from the grip'
                ],
                commonMistakes: [
                    'Attempting without underhook control',
                    'Weak figure-four grip',
                    'Not using it to create movement',
                    'Forcing submission without position',
                    'Allowing opponent to flatten you out',
                    'Not transitioning when defended'
                ],
                variations: ['Old school sweep', 'Kimura to dog fight', 'Kimura sweep series'],
                origin: 'half-guard'
            },
            {
                id: 'old-school-sweep-kimura',
                name: 'Old School Sweep to Kimura',
                fromId: 'half-guard',
                category: 'submission',
                difficulty: 'intermediate',
                offsetX: 400,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'From half guard bottom with underhook',
                    'Secure kimura grip on opponent\'s far arm',
                    'Post your free hand on mat behind you',
                    'Bridge and roll backwards over your shoulder',
                    'Roll opponent over you using kimura grip',
                    'Come up on top while maintaining kimura',
                    'Finish kimura or transition to mount'
                ],
                keyPoints: [
                    'Classic half guard technique',
                    'Kimura grip creates the leverage',
                    'Must commit to backwards roll',
                    'Post hand is critical for the roll',
                    'Keep kimura tight throughout',
                    'Can finish submission or take mount'
                ],
                commonMistakes: [
                    'Weak kimura grip',
                    'Not posting hand properly',
                    'Hesitating on the roll',
                    'Rolling at wrong angle',
                    'Losing grip during sweep',
                    'Not following through to top position',
                    'Allowing opponent to defend mid-roll'
                ],
                variations: ['Old school to mount', 'Old school to back take', 'Modified old school'],
                origin: 'half-guard'
            },
            {
                id: 'calf-slicer-half-guard',
                name: 'Calf Slicer from Half Guard',
                fromId: 'half-guard',
                category: 'submission',
                difficulty: 'advanced',
                offsetX: 550,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'From half guard bottom, establish strong lockdown',
                    'Control opponent\'s upper body and posture',
                    'Thread your leg behind opponent\'s trapped calf',
                    'Lock figure-four with your legs around their calf',
                    'Use your shin/knee as a wedge against their calf',
                    'Extend your legs while pulling them down',
                    'Apply compression by squeezing legs together'
                ],
                keyPoints: [
                    'Lockdown control is essential first',
                    'Leg positioning must be precise',
                    'Shin creates the pressure point',
                    'Control upper body to prevent escape',
                    'Compression comes from leg squeeze and extension',
                    'Can cause serious injury - tap early'
                ],
                commonMistakes: [
                    'Attempting without proper leg control',
                    'Poor shin placement on calf',
                    'Not controlling opponent\'s upper body',
                    'Forcing too quickly',
                    'Loose leg figure-four',
                    'Allowing opponent to posture up',
                    'Not enough compression pressure'
                ],
                variations: ['Calf slicer from deep half', 'Calf slicer from lockdown', 'Calf crush variation'],
                origin: 'half-guard'
            },
            // Half Guard Sweeps
            {
                id: 'john-wayne-sweep',
                name: 'John Wayne Sweep',
                fromId: 'half-guard',
                category: 'sweep',
                difficulty: 'basic',
                offsetX: 250,
                offsetY: 50,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'From half guard bottom, establish underhook',
                    'Reach across and control opponent\'s far arm or collar',
                    'Get your head to the outside of their body',
                    'Drive forward explosively with your shoulder',
                    'Use your legs to lift and drive opponent over',
                    'Come up on top to mount or side control'
                ],
                keyPoints: [
                    'Underhook is essential',
                    'Control far side to prevent posting',
                    'Head position outside prevents them basing',
                    'Drive forward, not just lifting',
                    'Explosive movement is key',
                    'Follow through to secure top position'
                ],
                commonMistakes: [
                    'Not securing underhook first',
                    'Poor head position allows defense',
                    'Not controlling far arm/leg',
                    'Lifting instead of driving forward',
                    'Slow, telegraphed movement',
                    'Not following through after sweep'
                ],
                variations: ['John Wayne to mount', 'John Wayne with whip up'],
                origin: 'half-guard'
            },
            {
                id: 'homer-simpson-sweep',
                name: 'Homer Simpson Sweep',
                fromId: 'half-guard',
                category: 'sweep',
                difficulty: 'intermediate',
                offsetX: 400,
                offsetY: 50,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'From half guard bottom, establish strong underhook',
                    'Reach across and grab opponent\'s far leg',
                    'Come up to your knees while maintaining controls',
                    'Drive forward with your shoulder into opponent',
                    'Lift their far leg while driving forward',
                    'Sweep opponent to their back',
                    'Come up to side control or mount'
                ],
                keyPoints: [
                    'Underhook and far leg control both essential',
                    'Must come up to your knees',
                    'Drive shoulder into opponent\'s chest',
                    'Lift leg while driving forward',
                    'Timing and coordination are key',
                    'Follow sweep to secure position'
                ],
                commonMistakes: [
                    'Weak underhook control',
                    'Not securing far leg properly',
                    'Staying flat instead of coming to knees',
                    'Not driving forward enough',
                    'Poor timing between lift and drive',
                    'Losing controls during sweep'
                ],
                variations: ['Homer Simpson to mount', 'Homer Simpson to back take'],
                origin: 'half-guard'
            },
            {
                id: 'waiter-sweep',
                name: 'Waiter Sweep',
                fromId: 'half-guard',
                category: 'sweep',
                difficulty: 'advanced',
                offsetX: 550,
                offsetY: 50,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'From half guard, transition to deep half guard',
                    'Get under opponent completely with your back to mat',
                    'Secure opponent\'s far leg with both arms',
                    'Position your shoulder under their near hip',
                    'Elevate opponent up like a waiter holding a tray',
                    'Tip opponent over to their back',
                    'Come up on top to side control or mount'
                ],
                keyPoints: [
                    'Must achieve deep half position first',
                    'Far leg control is critical',
                    'Shoulder placement under hip creates leverage',
                    'Elevation before tipping',
                    'Movement like waiter balancing tray',
                    'Control throughout the sweep'
                ],
                commonMistakes: [
                    'Not getting deep enough under opponent',
                    'Poor far leg control',
                    'Shoulder not positioned correctly',
                    'Trying to sweep without elevation',
                    'Losing control during sweep',
                    'Not following through to top position',
                    'Attempting from regular half instead of deep half'
                ],
                variations: ['Waiter sweep to back take', 'Modified waiter sweep', 'Waiter to mount'],
                origin: 'half-guard'
            },
            // X-Guard Passes/Escapes (from top)
            {
                id: 'backstep-pass',
                name: 'Backstep Pass',
                fromId: 'x-guard',
                category: 'pass',
                difficulty: 'intermediate',
                offsetX: -400,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'From top of X-Guard, maintain good posture',
                    'Identify which leg is the top hook',
                    'Step back explosively with the hooked leg',
                    'Circle around toward opponent\'s legs',
                    'Free your leg completely from hooks',
                    'Control opponent\'s legs as you circle',
                    'Complete pass to side control or leg drag position'
                ],
                keyPoints: [
                    'Timing is critical - step back explosively',
                    'Maintain upright posture throughout',
                    'Circle toward their legs, not away',
                    'Don\'t let them recompose guard',
                    'Control hips during the pass',
                    'Be ready for follow-up attacks'
                ],
                commonMistakes: [
                    'Stepping back too slowly',
                    'Poor posture allows them to off-balance you',
                    'Circling the wrong direction',
                    'Not controlling opponent\'s legs after escape',
                    'Allowing them to recover guard',
                    'Telegraphing the movement'
                ],
                variations: ['Backstep to leg drag', 'Backstep to knee slice'],
                origin: 'x-guard'
            },
            {
                id: 'leg-weave-x-guard',
                name: 'Leg Weave Pass from X-Guard',
                fromId: 'x-guard',
                category: 'pass',
                difficulty: 'intermediate',
                offsetX: -400,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'From top of X-Guard, control opponent\'s upper body',
                    'Weave your leg between opponent\'s hooks',
                    'Drive your weight forward and down',
                    'Use your leg to pry their legs apart',
                    'Smash their legs down to the mat',
                    'Continue forward pressure',
                    'Complete pass to side control or mount'
                ],
                keyPoints: [
                    'Forward pressure is essential',
                    'Weave leg deep between their hooks',
                    'Weight distribution must be forward',
                    'Smash legs down, don\'t let them elevate',
                    'Control upper body throughout',
                    'Be prepared for leg lock counters'
                ],
                commonMistakes: [
                    'Not weaving leg deep enough',
                    'Insufficient forward pressure',
                    'Allowing opponent to elevate you',
                    'Poor upper body control',
                    'Not smashing legs down effectively',
                    'Leaving leg vulnerable to attacks'
                ],
                variations: ['Leg weave to knee on belly', 'Leg weave to mount'],
                origin: 'x-guard'
            },
            {
                id: 'kneebar-counter-x-guard',
                name: 'Rolling Kneebar Counter',
                fromId: 'x-guard',
                category: 'pass',
                difficulty: 'advanced',
                offsetX: -550,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'When opponent attempts X-Guard sweep/elevation',
                    'As they elevate, secure control of their leg',
                    'Allow yourself to roll with their momentum',
                    'Maintain leg control throughout the roll',
                    'Roll backwards over your shoulder',
                    'Come up on top with opponent\'s leg trapped',
                    'Secure kneebar position and finish submission'
                ],
                keyPoints: [
                    'Requires excellent timing and leg dexterity',
                    'Use their elevation against them',
                    'Leg control must be maintained throughout',
                    'Roll with the momentum, don\'t fight it',
                    'Come up immediately into kneebar position',
                    'Can transition to pass if submission not available'
                ],
                commonMistakes: [
                    'Fighting the elevation instead of using it',
                    'Losing leg control during roll',
                    'Poor rolling technique',
                    'Not securing kneebar position properly',
                    'Attempting without proper timing',
                    'Forcing roll at wrong moment',
                    'Not following through to finish'
                ],
                variations: ['Counter to heel hook', 'Counter to leg drag pass', 'Rolling footlock counter'],
                origin: 'x-guard'
            },
            // X-Guard Sweeps
            {
                id: 'technical-stand-sweep',
                name: 'Technical Stand Sweep',
                fromId: 'x-guard',
                category: 'sweep',
                difficulty: 'intermediate',
                offsetX: 400,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'From X-Guard position, maintain hooks on opponent\'s leg',
                    'Control opponent\'s sleeve or collar with your hands',
                    'Use X-Guard elevation to create space',
                    'Post your bottom hand on the mat',
                    'Come up to technical stand position',
                    'Dump opponent to the side or take back',
                    'Establish top position or back control'
                ],
                keyPoints: [
                    'Maintain hook control throughout',
                    'Use elevation to create space for standing',
                    'Technical stand requires posting hand',
                    'Keep opponent off-balance',
                    'Multiple finish options available',
                    'Transition smoothly to dominant position'
                ],
                commonMistakes: [
                    'Losing hooks while standing',
                    'Not creating enough elevation first',
                    'Poor hand posting',
                    'Allowing opponent to regain base',
                    'Not following through to top position',
                    'Standing too slowly'
                ],
                variations: ['Technical stand to back take', 'Technical stand to leg drag'],
                origin: 'x-guard'
            },
            {
                id: 'x-guard-back-take',
                name: 'X-Guard to Back Take',
                fromId: 'x-guard',
                category: 'sweep',
                difficulty: 'intermediate',
                offsetX: 400,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'From X-Guard, establish strong hooks on opponent\'s leg',
                    'Control opponent\'s upper body with grips',
                    'Elevate opponent with your hooks',
                    'Rotate your body to the side as you elevate',
                    'Come up on your knees behind opponent',
                    'Secure seatbelt grip as they face away',
                    'Establish back control with hooks'
                ],
                keyPoints: [
                    'Elevation and rotation must be coordinated',
                    'Keep opponent off-balance throughout',
                    'Transition smoothly behind opponent',
                    'Secure seatbelt immediately',
                    'Get hooks in before they recover',
                    'Maintain pressure throughout transition'
                ],
                commonMistakes: [
                    'Not elevating enough before rotating',
                    'Poor timing between elevation and rotation',
                    'Losing grip control during transition',
                    'Not coming up fast enough',
                    'Allowing opponent to turn and face you',
                    'Not securing back control immediately'
                ],
                variations: ['X-Guard to crucifix', 'X-Guard to truck position'],
                origin: 'x-guard'
            },
            {
                id: 'kiss-of-dragon',
                name: 'Kiss of the Dragon',
                fromId: 'x-guard',
                category: 'sweep',
                difficulty: 'advanced',
                offsetX: 550,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'From X-Guard, establish deep control on opponent',
                    'Invert and roll backwards under opponent',
                    'Thread your body underneath as they lean forward',
                    'Keep rolling through to come out behind them',
                    'Your shoulders should roll along the mat',
                    'Come up directly to opponent\'s back',
                    'Secure back control with seatbelt and hooks'
                ],
                keyPoints: [
                    'Requires excellent flexibility and timing',
                    'Must fully commit to the inversion',
                    'Roll smoothly under opponent',
                    'Keep body tight during the roll',
                    'Emerge directly behind opponent',
                    'Immediate back control is the goal'
                ],
                commonMistakes: [
                    'Not inverting deep enough',
                    'Hesitating during the roll',
                    'Poor body positioning during inversion',
                    'Not rolling all the way through',
                    'Losing control during transition',
                    'Coming up too far from opponent\'s back',
                    'Insufficient flexibility for the movement'
                ],
                variations: ['Kiss of the dragon to truck', 'Modified kiss of the dragon', 'Kiss of the dragon from single leg X'],
                origin: 'x-guard'
            },
            // X-Guard Submissions
            {
                id: 'ankle-lock-x-guard',
                name: 'Straight Ankle Lock from X-Guard',
                fromId: 'x-guard',
                category: 'submission',
                difficulty: 'intermediate',
                offsetX: 400,
                offsetY: 50,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'From X-Guard, maintain hooks on opponent\'s leg',
                    'Secure opponent\'s ankle with both hands',
                    'Fall back to your side or back',
                    'Trap opponent\'s leg between your legs',
                    'Position ankle across your hip/belly',
                    'Lock hands around ankle (palm to palm or figure-four)',
                    'Arch back and extend hips to apply pressure'
                ],
                keyPoints: [
                    'Ankle must be trapped tightly',
                    'Foot positioning is critical - toes up',
                    'Hips drive into ankle for pressure',
                    'Control opponent\'s knee to prevent escape',
                    'Arch your back while extending',
                    'Keep opponent\'s toes pointing up'
                ],
                commonMistakes: [
                    'Weak grip on ankle',
                    'Not controlling opponent\'s knee',
                    'Poor hip positioning',
                    'Pulling instead of arching',
                    'Allowing opponent to turn their foot',
                    'Not trapping leg properly between legs'
                ],
                variations: ['Ankle lock from single leg X', 'Ankle lock to kneebar transition'],
                origin: 'x-guard'
            },
            {
                id: 'kneebar-x-guard',
                name: 'Kneebar from X-Guard',
                fromId: 'x-guard',
                category: 'submission',
                difficulty: 'intermediate',
                offsetX: 400,
                offsetY: 50,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'From X-Guard, control opponent\'s leg',
                    'Fall to your side while maintaining leg control',
                    'Position opponent\'s knee across your hips',
                    'Trap their leg between your legs',
                    'Secure control of their ankle/foot',
                    'Lock hands in figure-four or palm-to-palm grip',
                    'Arch back and extend hips to hyperextend knee'
                ],
                keyPoints: [
                    'Knee must be isolated above your hip',
                    'Control ankle to prevent spinning',
                    'Hips thrust upward for pressure',
                    'Keep opponent\'s leg trapped tight',
                    'Arch back while extending hips',
                    'Can transition from ankle lock'
                ],
                commonMistakes: [
                    'Knee positioned too low',
                    'Not controlling opponent\'s ankle',
                    'Allowing opponent to spin out',
                    'Weak leg trap',
                    'Pulling instead of arching/extending',
                    'Not isolating the knee properly',
                    'Forcing submission too quickly'
                ],
                variations: ['Kneebar from single leg X', 'Kneebar to heel hook transition', 'Rolling kneebar'],
                origin: 'x-guard'
            },
            {
                id: 'estima-lock',
                name: 'Estima Lock',
                fromId: 'x-guard',
                category: 'submission',
                difficulty: 'advanced',
                offsetX: 550,
                offsetY: 50,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'From X-Guard, control opponent\'s leg',
                    'Invert and position yourself upside down',
                    'Thread your leg over opponent\'s ankle/foot',
                    'Lock your feet together in figure-four around their ankle',
                    'Your shin applies pressure to their achilles',
                    'Extend your legs while squeezing',
                    'Apply pressure by straightening and twisting'
                ],
                keyPoints: [
                    'Requires flexibility and precise positioning',
                    'Named after Braulio Estima',
                    'Attacks ankle and achilles simultaneously',
                    'Inverted footlock variation',
                    'Shin pressure on achilles is key',
                    'Very painful - respect the tap'
                ],
                commonMistakes: [
                    'Not inverting properly',
                    'Poor foot positioning on ankle',
                    'Loose figure-four lock',
                    'Not creating proper shin pressure',
                    'Attempting without flexibility',
                    'Forcing too quickly without control',
                    'Not securing the lock before extending'
                ],
                variations: ['Estima lock from 50/50', 'Modified estima lock', 'Estima lock from single leg X'],
                origin: 'x-guard'
            },
            // Butterfly Guard Passes/Escapes (from top)
            {
                id: 'knee-slice-butterfly',
                name: 'Knee Slice from Butterfly',
                fromId: 'butterfly-guard',
                category: 'pass',
                difficulty: 'intermediate',
                offsetX: -400,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'From top of butterfly guard, establish strong base',
                    'Control opponent\'s upper body with grips',
                    'Clear opponent\'s hooks by creating space',
                    'Drive your knee across opponent\'s legs',
                    'Keep weight forward and pressure down',
                    'Slide knee through while blocking their hip',
                    'Complete pass to side control with crossface'
                ],
                keyPoints: [
                    'Clear hooks before attempting pass',
                    'Forward pressure is essential',
                    'Knee drives low across belly',
                    'Block opponent\'s hip with hand',
                    'Maintain crossface control',
                    'Don\'t let them reestablish hooks'
                ],
                commonMistakes: [
                    'Not clearing hooks completely',
                    'Rising up too high',
                    'Poor upper body control',
                    'Not blocking hip during pass',
                    'Allowing opponent to get back to butterfly',
                    'Insufficient forward pressure'
                ],
                variations: ['Knee slice to mount', 'Knee slice to knee on belly'],
                origin: 'butterfly-guard'
            },
            {
                id: 'granby-roll-counter-butterfly',
                name: 'Granby Roll Counter',
                fromId: 'butterfly-guard',
                category: 'pass',
                difficulty: 'advanced',
                offsetX: -550,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'When opponent attempts butterfly sweep',
                    'As they elevate you, don\'t resist the lift',
                    'Tuck your chin to chest immediately',
                    'Roll backwards over your shoulder with momentum',
                    'Continue rolling through the movement',
                    'Use opponent\'s elevation against them',
                    'Come up on top or reverse to dominant position'
                ],
                keyPoints: [
                    'Requires excellent timing and flexibility',
                    'Use their sweep momentum to your advantage',
                    'Protect your neck during roll',
                    'Roll over shoulder, not straight back',
                    'Commit fully to the movement',
                    'Be ready to scramble after roll'
                ],
                commonMistakes: [
                    'Resisting the elevation instead of using it',
                    'Poor head/neck positioning',
                    'Hesitating mid-roll',
                    'Rolling at wrong angle',
                    'Not committing fully',
                    'Not following through to secure position',
                    'Attempting without proper flexibility'
                ],
                variations: ['Granby to back take', 'Granby to guard recovery', 'Counter to turtle'],
                origin: 'butterfly-guard'
            },
            // Butterfly Guard Sweeps
            {
                id: 'basic-butterfly-sweep',
                name: 'Basic Butterfly Sweep',
                fromId: 'butterfly-guard',
                category: 'sweep',
                difficulty: 'intermediate',
                offsetX: 400,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'From butterfly guard, sit up with strong posture',
                    'Establish hooks on opponent\'s inner thighs',
                    'Control opponent\'s sleeves or collar and sleeve',
                    'Pull opponent forward breaking their posture',
                    'Elevate with your hooks while pulling',
                    'Roll backward slightly and sweep to the side',
                    'Come up on top to mount or side control'
                ],
                keyPoints: [
                    'Sit up with strong posture - don\'t lie back',
                    'Hooks must be on inner thighs',
                    'Break posture before elevating',
                    'Pull and lift work together',
                    'Direction is forward and to the side',
                    'Follow through to secure top position'
                ],
                commonMistakes: [
                    'Lying back flat instead of sitting up',
                    'Hooks too shallow or too deep',
                    'Not breaking posture first',
                    'Lifting without pulling',
                    'Sweeping straight back instead of to side',
                    'Not following through after sweep'
                ],
                variations: ['Butterfly sweep to mount', 'Butterfly sweep with underhook'],
                origin: 'butterfly-guard'
            },
            {
                id: 'tornado-sweep',
                name: 'Tornado Sweep',
                fromId: 'butterfly-guard',
                category: 'sweep',
                difficulty: 'advanced',
                offsetX: 550,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'From butterfly guard, establish hooks and grips',
                    'Create momentum by rocking opponent',
                    'As opponent posts, explosively spin underneath',
                    'Maintain hooks while rotating your body',
                    'Use rotational momentum to elevate opponent',
                    'Complete 180-degree spin under opponent',
                    'Come up behind opponent for back control or complete sweep to mount'
                ],
                keyPoints: [
                    'Requires timing, speed, and coordination',
                    'Momentum and rotation are key',
                    'Maintain hooks throughout the spin',
                    'Must commit fully to the movement',
                    'Multiple finish options available',
                    'Can catch opponent by surprise'
                ],
                commonMistakes: [
                    'Not creating enough initial momentum',
                    'Hesitating during the spin',
                    'Losing hooks mid-rotation',
                    'Poor timing - spinning too early or late',
                    'Not completing full rotation',
                    'Losing grip control during spin',
                    'Insufficient explosiveness'
                ],
                variations: ['Tornado sweep to back take', 'Tornado to mount', 'Modified tornado sweep'],
                origin: 'butterfly-guard'
            },
            // North-South Escapes
            {
                id: 'bridge-and-turn',
                name: 'Bridge and Turn',
                fromId: 'north-south',
                category: 'escape',
                difficulty: 'intermediate',
                offsetX: -400,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'From bottom of north-south, create frames with arms',
                    'Choose a direction to turn toward',
                    'Bridge explosively with hips',
                    'As you bridge, turn your body to the side',
                    'Use the momentum to create space',
                    'Insert knee shield or recover guard',
                    'Complete escape to guard or scramble'
                ],
                keyPoints: [
                    'Timing is critical - wait for right moment',
                    'Explosive bridge is essential',
                    'Turn and bridge must be coordinated',
                    'Create frames before bridging',
                    'Don\'t bridge straight up - turn to side',
                    'Follow through to complete escape'
                ],
                commonMistakes: [
                    'Weak or slow bridge',
                    'Bridging without turning',
                    'Not creating frames first',
                    'Poor timing of the movement',
                    'Not following through after bridge',
                    'Allowing opponent to resettle position'
                ],
                variations: ['Bridge to half guard', 'Bridge to turtle'],
                origin: 'north-south'
            },
            {
                id: 'granby-roll-north-south',
                name: 'Granby Roll Escape',
                fromId: 'north-south',
                category: 'escape',
                difficulty: 'advanced',
                offsetX: -550,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'From bottom of north-south, protect your neck',
                    'Create initial space with frames',
                    'Tuck chin to chest and commit to backwards roll',
                    'Roll backwards over your shoulder',
                    'Use granby motion to complete the roll',
                    'Come up facing opponent or to your side',
                    'Recover guard or scramble to top position'
                ],
                keyPoints: [
                    'Requires flexibility and timing',
                    'Protect neck throughout the roll',
                    'Must commit fully to the movement',
                    'Roll over shoulder, not straight back',
                    'Create space before attempting',
                    'Be ready to defend immediately after'
                ],
                commonMistakes: [
                    'Not protecting neck properly',
                    'Hesitating during the roll',
                    'Rolling at wrong angle',
                    'Not creating enough initial space',
                    'Insufficient commitment to movement',
                    'Poor flexibility limiting execution',
                    'Not following through to safe position'
                ],
                variations: ['Granby to guard recovery', 'Granby to scramble', 'Granby to technical standup'],
                origin: 'north-south'
            },
            // North-South Submissions
            {
                id: 'north-south-choke',
                name: 'North-South Choke',
                fromId: 'north-south',
                category: 'submission',
                difficulty: 'intermediate',
                offsetX: 400,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'From north-south position on top',
                    'Thread your arm around opponent\'s neck',
                    'Lock hands together (palm to palm or gable grip)',
                    'Drive your shoulder into side of their neck',
                    'Squeeze arms together while driving shoulder',
                    'Apply pressure by expanding chest and squeezing'
                ],
                keyPoints: [
                    'Arm must be deep around neck',
                    'Shoulder pressure is critical',
                    'Squeeze and drive together',
                    'Keep your weight heavy on opponent',
                    'Choke comes from shoulder, not just arms',
                    'Maintain chest-to-chest pressure'
                ],
                commonMistakes: [
                    'Shallow arm position on neck',
                    'Not using shoulder pressure',
                    'Rising up too high',
                    'Weak hand connection',
                    'Only pulling with arms',
                    'Allowing opponent to turn'
                ],
                variations: ['North-south choke with kimura grip', 'Modified north-south choke'],
                origin: 'north-south'
            },
            {
                id: 'monoplata',
                name: 'Monoplata',
                fromId: 'north-south',
                category: 'submission',
                difficulty: 'advanced',
                offsetX: 550,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'From north-south, isolate opponent\'s arm',
                    'Bring your leg over their trapped arm',
                    'Thread your leg under their arm and over their shoulder',
                    'Lock your legs together in figure-four',
                    'Control their wrist with your hands',
                    'Apply shoulder lock by extending your legs',
                    'Drive pressure into their shoulder joint'
                ],
                keyPoints: [
                    'Requires flexibility and precise positioning',
                    'Arm must be completely isolated',
                    'Leg positioning is critical',
                    'Control wrist to prevent spinning',
                    'Extension creates shoulder lock',
                    'Similar mechanics to omoplata'
                ],
                commonMistakes: [
                    'Not isolating arm properly first',
                    'Poor leg positioning',
                    'Loose figure-four lock',
                    'Not controlling opponent\'s wrist',
                    'Insufficient flexibility',
                    'Forcing submission without control',
                    'Allowing opponent to roll forward'
                ],
                variations: ['Monoplata from side control', 'Monoplata to armbar', 'Modified monoplata'],
                origin: 'north-south'
            },
                        // STUB TECHNIQUES REMOVED
            // To add them back, see bjj-stub-techniques.js
            
            // COUNTERS REMOVED
            // Counters are in bjj-stub-techniques.js
            
// Back Control Submissions
            {
                id: 'rear-naked-choke',
                name: 'Rear Naked Choke',
                fromId: 'back-mount',
                category: 'submission',
                difficulty: 'basic',
                offsetX: 250,
                offsetY: 0,
                gi: false,
                nogi: true,
                gifUrl: null,
                steps: [
                    'Maintain seatbelt control',
                    'Slide choking arm under opponent\'s chin',
                    'Lock hands (palm to bicep)',
                    'Squeeze elbows together'
                ],
                keyPoints: [
                    'Get forearm across throat, not chin',
                    'Expand chest while squeezing',
                    'Keep hooks in throughout'
                ],
                commonMistakes: [
                    'Choking the chin instead of neck',
                    'Weak hand connection',
                    'Losing hook control'
                ],
                variations: ['Short choke', 'Body triangle variation'],
                origin: 'back-mount'
            },
            {
                id: 'short-choke',
                name: 'Short Choke',
                fromId: 'back-mount',
                category: 'submission',
                difficulty: 'basic',
                offsetX: 250,
                offsetY: 50,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'Establish seatbelt grip from back control',
                    'Slide choking hand inside opponent\'s defensive grip',
                    'Turn hand so forearm blade crosses throat',
                    'Place other hand behind opponent\'s head',
                    'Squeeze elbow tight to your ribs',
                    'Drive forearm across throat while pulling head'
                ],
                keyPoints: [
                    'Forearm blade creates the choke, not bicep',
                    'Quick finish - opponent has less time to defend',
                    'Keep tight to opponent\'s back',
                    'Squeeze elbow to ribs for maximum pressure',
                    'Works well when RNC is defended'
                ],
                commonMistakes: [
                    'Not getting forearm blade positioned correctly',
                    'Allowing too much space',
                    'Not squeezing elbow tight enough',
                    'Losing back control during attempt',
                    'Choking with wrong part of arm'
                ],
                variations: ['Short choke with collar grip', 'Standing short choke'],
                origin: 'back-mount'
            },
            {
                id: 'armbar-from-back',
                name: 'Armbar from Back',
                fromId: 'back-mount',
                category: 'submission',
                difficulty: 'basic',
                offsetX: 250,
                offsetY: 100,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'From back control, isolate opponent\'s arm',
                    'Feed arm across to your other hand',
                    'Swing top leg over opponent\'s head',
                    'Fall to your hip while controlling arm',
                    'Keep opponent\'s arm extended and thumb up',
                    'Squeeze knees together and lift hips for armbar'
                ],
                keyPoints: [
                    'Secure arm control before transitioning',
                    'Keep opponent\'s thumb pointing up',
                    'Control wrist with both hands',
                    'Don\'t lose back control too early',
                    'Squeeze knees tightly together'
                ],
                commonMistakes: [
                    'Not isolating arm properly first',
                    'Allowing opponent to turn into you',
                    'Losing wrist control during transition',
                    'Not controlling opponent\'s posture',
                    'Releasing hooks too early'
                ],
                variations: ['Armbar to triangle', 'Rolling armbar from back', 'Armbar from body triangle'],
                origin: 'back-mount'
            },
            {
                id: 'bow-and-arrow',
                name: 'Bow and Arrow Choke',
                fromId: 'back-mount',
                category: 'submission',
                difficulty: 'intermediate',
                offsetX: 400,
                offsetY: -50,
                gi: true,
                nogi: false,
                gifUrl: null,
                steps: [
                    'Establish collar grip from back',
                    'Thread other hand inside to grab pants',
                    'Roll to side and extend legs',
                    'Pull collar while stretching opponent'
                ],
                keyPoints: [
                    'Deep collar grip is essential',
                    'Strong pant grip for leverage',
                    'Full body extension for pressure'
                ],
                commonMistakes: [
                    'Shallow collar grip',
                    'Not rolling properly',
                    'Insufficient leg extension'
                ],
                variations: ['Modified bow and arrow without gi'],
                origin: 'back-mount'
            },
            {
                id: 'body-triangle-rnc',
                name: 'Body Triangle to RNC',
                fromId: 'back-mount',
                category: 'submission',
                difficulty: 'intermediate',
                offsetX: 400,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'From back control with hooks, identify opportunity',
                    'Bring one leg across opponent\'s body to opposite hip',
                    'Lock triangle by placing foot behind opposite knee',
                    'Squeeze legs together to compress opponent\'s core',
                    'Maintain seatbelt control throughout',
                    'Slide choking arm under chin for rear naked choke',
                    'Finish choke while maintaining triangle pressure'
                ],
                keyPoints: [
                    'Body triangle prevents opponent from turning',
                    'Lock must be tight - foot behind knee',
                    'Squeeze legs to compress torso',
                    'Triangle creates better control than hooks',
                    'Opponent cannot escape as easily',
                    'Combine squeeze with choke for double pressure'
                ],
                commonMistakes: [
                    'Loose triangle lock allows escape',
                    'Not maintaining upper body control',
                    'Forgetting to squeeze legs while choking',
                    'Locking triangle too high or too low',
                    'Losing position while setting triangle',
                    'Not using compression before attempting choke'
                ],
                variations: ['Body triangle to armbar', 'Body triangle to collar choke'],
                origin: 'back-mount'
            },
            {
                id: 'crucifix-from-back',
                name: 'Crucifix from Back',
                fromId: 'back-mount',
                category: 'submission',
                difficulty: 'advanced',
                offsetX: 550,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'From back control, trap opponent\'s near arm with your leg',
                    'Thread your arm under their far armpit',
                    'Pull their far arm across and trap it',
                    'Secure crucifix position with both arms trapped',
                    'Apply collar choke, rear naked choke, or strikes',
                    'Maintain control with leg pressure on trapped arm'
                ],
                keyPoints: [
                    'Both arms must be completely trapped',
                    'Leg control on near arm is critical',
                    'Far arm trapped by threading under armpit',
                    'Opponent is completely defenseless',
                    'Multiple submission options available',
                    'Can be used in gi or no-gi with modifications'
                ],
                commonMistakes: [
                    'Not trapping both arms securely',
                    'Allowing opponent to free near arm',
                    'Losing back control during setup',
                    'Not maintaining leg pressure',
                    'Rushing the position without full control',
                    'Not capitalizing on submission opportunities'
                ],
                variations: ['Crucifix to neck crank', 'Crucifix to collar choke', 'Crucifix in MMA for strikes'],
                origin: 'back-mount'
            },
            // Back Control Escapes
            {
                id: 'hand-fighting-clear-hooks',
                name: 'Hand Fighting to Clear Hooks',
                fromId: 'back-mount',
                category: 'escape',
                difficulty: 'basic',
                offsetX: -250,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'Immediately address choking hand with both hands',
                    'Fight to remove choking hand from your neck',
                    'Tuck chin and protect throat throughout',
                    'Clear bottom hook by stepping over with your leg',
                    'Turn into opponent to face them',
                    'Recover to guard position'
                ],
                keyPoints: [
                    'Two hands beat one hand - fight the choke',
                    'Protect neck at all costs',
                    'Clear bottom hook first',
                    'Turn toward the choking arm side',
                    'Stay calm and methodical'
                ],
                commonMistakes: [
                    'Panicking and not addressing the choke',
                    'Trying to clear hooks before hand fighting',
                    'Turning to the wrong side',
                    'Not tucking chin to protect neck',
                    'Giving up back exposure after clearing one hook'
                ],
                variations: ['Clear hooks to guard', 'Clear hooks to turtle'],
                origin: 'back-mount'
            },
            {
                id: 'scoot-and-turn-escape',
                name: 'Scoot and Turn Escape',
                fromId: 'back-mount',
                category: 'escape',
                difficulty: 'basic',
                offsetX: -250,
                offsetY: 50,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'Protect neck by tucking chin and addressing choke',
                    'Scoot your hips down toward opponent\'s hips',
                    'As you scoot, create space to clear bottom hook',
                    'Step over the bottom hook with your leg',
                    'Turn into opponent while maintaining hand control',
                    'Recover to guard or half guard position'
                ],
                keyPoints: [
                    'Hip movement is key - scoot down, not away',
                    'Keep chin tucked throughout',
                    'Clear hooks one at a time',
                    'Turn toward choking arm side',
                    'Maintain grip fighting on choke hand'
                ],
                commonMistakes: [
                    'Not scooting hips down enough',
                    'Trying to turn before clearing hooks',
                    'Exposing neck during the turn',
                    'Moving too slowly without commitment',
                    'Not maintaining hand control on choke'
                ],
                variations: ['Scoot to turtle', 'Scoot to half guard'],
                origin: 'back-mount'
            },
            {
                id: 'back-escape-basic',
                name: 'Basic Back Escape',
                fromId: 'back-mount',
                category: 'escape',
                difficulty: 'intermediate',
                offsetX: -400,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'Address the choke hand immediately',
                    'Clear bottom hook by stepping over',
                    'Turn into opponent',
                    'Recover guard or scramble'
                ],
                keyPoints: [
                    'Protect neck first, always',
                    'Remove one hook at a time',
                    'Turn towards choking arm side'
                ],
                commonMistakes: [
                    'Ignoring choke defense',
                    'Trying to escape without clearing hooks',
                    'Turning to wrong side'
                ],
                variations: ['Granby roll escape'],
                origin: 'back-mount'
            },
            {
                id: 'granby-roll-reversal',
                name: 'Granby Roll to Reversal',
                fromId: 'back-mount',
                category: 'escape',
                difficulty: 'advanced',
                offsetX: -550,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'Protect neck and address choking hand',
                    'Create space by bringing knees to chest',
                    'Explosively tuck chin and roll backwards over shoulder',
                    'Invert through the roll maintaining tight body position',
                    'Post hand on mat to complete rotation',
                    'Come up on top or reverse to opponent\'s back',
                    'Secure dominant position or take the back'
                ],
                keyPoints: [
                    'Requires excellent timing and flexibility',
                    'Must commit fully to the roll',
                    'Protect neck throughout the movement',
                    'Roll over shoulder, not straight back',
                    'Use opponent\'s weight and momentum',
                    'Stay tight throughout inversion'
                ],
                commonMistakes: [
                    'Rolling at wrong angle (too straight)',
                    'Not protecting neck during roll',
                    'Hesitating mid-movement',
                    'Poor flexibility limiting execution',
                    'Not following through to dominant position',
                    'Leaving neck exposed during transition'
                ],
                variations: ['Granby to back take', 'Granby to guard recovery', 'Peterson roll from wrestling'],
                origin: 'back-mount'
            },
            // Turtle Escapes
            {
                id: 'sit-out-escape',
                name: 'Sit Out Escape',
                fromId: 'turtle',
                category: 'escape',
                difficulty: 'basic',
                offsetX: -250,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'Post on one hand and keep base strong',
                    'Explosively sit out to the side',
                    'Kick your inside leg through and clear opponent\'s hook',
                    'Turn to face opponent as you sit through',
                    'Come up to knees or technical stand-up',
                    'Re-engage or create distance'
                ],
                keyPoints: [
                    'Explosive movement is essential',
                    'Keep posting hand strong throughout',
                    'Kick leg through with power',
                    'Don\'t sit back - sit to the side',
                    'Be ready to defend or scramble after'
                ],
                commonMistakes: [
                    'Moving too slowly without explosion',
                    'Sitting straight back instead of to side',
                    'Not clearing opponent\'s hook fully',
                    'Weak posting hand allows opponent to flatten',
                    'Not following through to stand or re-engage'
                ],
                variations: ['Sit out to single leg', 'Sit out to stand', 'Sit out to guard'],
                origin: 'turtle'
            },
            {
                id: 'roll-through-escape',
                name: 'Roll Through Escape',
                fromId: 'turtle',
                category: 'escape',
                difficulty: 'basic',
                offsetX: -250,
                offsetY: 50,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'Tuck chin to chest and protect neck',
                    'Choose direction and commit to the roll',
                    'Post one hand out to side for momentum',
                    'Roll forward over your shoulder',
                    'Continue rolling to come up to seated or guard',
                    'Recover guard position or scramble'
                ],
                keyPoints: [
                    'Protect neck throughout entire movement',
                    'Commit fully to the roll',
                    'Roll over shoulder, not straight forward',
                    'Use momentum to complete the movement',
                    'Be ready to defend immediately after'
                ],
                commonMistakes: [
                    'Not protecting neck during roll',
                    'Hesitating mid-roll',
                    'Rolling at wrong angle',
                    'Not using enough momentum',
                    'Leaving back exposed after roll'
                ],
                variations: ['Roll to closed guard', 'Roll to open guard', 'Roll to technical stand'],
                origin: 'turtle'
            },
            {
                id: 'switch-single-leg',
                name: 'Switch to Single Leg',
                fromId: 'turtle',
                category: 'escape',
                difficulty: 'intermediate',
                offsetX: -400,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'From turtle, identify opponent\'s weight distribution',
                    'Explosively switch your hips and change direction',
                    'Reach through and capture opponent\'s near leg',
                    'Drive forward and come up to knees',
                    'Secure single leg position with proper control',
                    'Finish the takedown or pass to top position'
                ],
                keyPoints: [
                    'Timing and explosion are critical',
                    'Hip switch must be fast and committed',
                    'Secure the leg immediately upon switching',
                    'Drive forward with good posture',
                    'Don\'t telegraph the movement'
                ],
                commonMistakes: [
                    'Slow, telegraphed hip switch',
                    'Not securing the leg properly',
                    'Poor head position after switch',
                    'Hesitating after capturing leg',
                    'Allowing opponent to sprawl'
                ],
                variations: ['Switch to double leg', 'Switch to back take', 'Switch to leg drag pass'],
                origin: 'turtle'
            },
            {
                id: 'inside-spin-back-take',
                name: 'Inside Spin to Back Take',
                fromId: 'turtle',
                category: 'escape',
                difficulty: 'advanced',
                offsetX: -550,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'From turtle with opponent controlling from side or back',
                    'Identify the opening on opponent\'s inside',
                    'Explosively spin your body inside opponent\'s base',
                    'Thread your arm under and around opponent\'s body',
                    'Continue spinning to come behind opponent',
                    'Secure back control with seatbelt and hooks',
                    'Lock in back mount position'
                ],
                keyPoints: [
                    'Requires perfect timing and speed',
                    'Must read opponent\'s weight distribution',
                    'Explosive rotation is essential',
                    'Keep body tight during spin',
                    'Immediately establish hooks after spin',
                    'Don\'t give opponent time to defend'
                ],
                commonMistakes: [
                    'Spinning at wrong moment',
                    'Moving too slowly',
                    'Not completing the full rotation',
                    'Allowing opponent to defend mid-spin',
                    'Not securing back control immediately',
                    'Telegraphing the movement'
                ],
                variations: ['Inside spin to mount', 'Inside spin to scramble', 'Spin to leg entanglement'],
                origin: 'turtle'
            },
            // Turtle Submissions
            {
                id: 'clock-choke',
                name: 'Clock Choke',
                fromId: 'turtle',
                category: 'submission',
                difficulty: 'basic',
                offsetX: 250,
                offsetY: 0,
                gi: true,
                nogi: false,
                gifUrl: null,
                steps: [
                    'From top of turtle, secure deep collar grip with one hand',
                    'Walk your feet around opponent\'s head like a clock',
                    'Keep hips low and maintain pressure on opponent',
                    'Secure second collar grip as you circle',
                    'Pull collar tight while continuing to circle',
                    'Apply pressure by squeezing elbows together and driving chest down'
                ],
                keyPoints: [
                    'Deep collar grip is essential - four fingers in',
                    'Keep hips low and heavy throughout',
                    'Circle toward the choking arm side',
                    'Maintain constant pressure on opponent',
                    'Choke tightens as you complete the circle'
                ],
                commonMistakes: [
                    'Shallow collar grip allows easy defense',
                    'Rising up too high loses pressure',
                    'Not circling far enough',
                    'Allowing opponent to sit back and defend',
                    'Rushing the movement without control'
                ],
                variations: ['Clock choke from side control', 'Modified clock choke'],
                origin: 'turtle'
            },
            {
                id: 'crucifix-collar-choke',
                name: 'Crucifix Control to Collar Choke',
                fromId: 'turtle',
                category: 'submission',
                difficulty: 'basic',
                offsetX: 250,
                offsetY: 50,
                gi: true,
                nogi: false,
                gifUrl: null,
                steps: [
                    'From top of turtle, trap opponent\'s near arm with your leg',
                    'Trap opponent\'s far arm by threading your arm through',
                    'Secure crucifix position with both arms trapped',
                    'Reach for opponent\'s collar with free hand',
                    'Secure deep collar grip across their neck',
                    'Apply choke by pulling collar and driving shoulder'
                ],
                keyPoints: [
                    'Both arms must be trapped securely',
                    'Maintain crucifix control throughout',
                    'Deep collar grip is critical',
                    'Use shoulder pressure to finish',
                    'Keep opponent flattened with your weight'
                ],
                commonMistakes: [
                    'Not securing both arm traps properly',
                    'Shallow collar grip',
                    'Allowing opponent to free an arm',
                    'Not using enough shoulder pressure',
                    'Losing position while reaching for collar'
                ],
                variations: ['Crucifix to armbar', 'Crucifix to rear naked choke', 'Back take from crucifix'],
                origin: 'turtle'
            },
            {
                id: 'anaconda-choke',
                name: 'Anaconda Choke',
                fromId: 'turtle',
                category: 'submission',
                difficulty: 'intermediate',
                offsetX: 400,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'From top of turtle, secure front headlock control',
                    'Thread your arm under opponent\'s near arm and around neck',
                    'Lock hands together in gable grip or S-grip',
                    'Roll opponent toward their trapped arm side',
                    'Land on your side with opponent\'s arm trapped',
                    'Squeeze arms together while expanding chest to finish'
                ],
                keyPoints: [
                    'Deep arm placement around neck is crucial',
                    'Trap opponent\'s arm fully before rolling',
                    'Roll toward the trapped arm side',
                    'Lock hands tightly together',
                    'Squeeze and expand to apply pressure'
                ],
                commonMistakes: [
                    'Shallow arm position around neck',
                    'Rolling to wrong side',
                    'Not trapping the arm properly',
                    'Weak hand grip allows escape',
                    'Not committing to the roll'
                ],
                variations: ['Standing anaconda', 'Anaconda from sprawl', 'Marce choke (modified anaconda)'],
                origin: 'turtle'
            },
            {
                id: 'darce-choke',
                name: 'D\'Arce Choke',
                fromId: 'turtle',
                category: 'submission',
                difficulty: 'intermediate',
                offsetX: 400,
                offsetY: 50,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'From top of turtle, control opponent from side',
                    'Thread your arm under opponent\'s near arm',
                    'Reach around and behind their neck',
                    'Lock hands together with your other arm',
                    'Drive your shoulder into their head',
                    'Squeeze arms together and apply pressure with shoulder'
                ],
                keyPoints: [
                    'Arm must go deep under their armpit',
                    'Lock hands tightly behind their neck',
                    'Shoulder pressure is critical for finish',
                    'Keep opponent\'s arm trapped throughout',
                    'Drive weight into the choke'
                ],
                commonMistakes: [
                    'Not threading arm deep enough',
                    'Weak hand lock allows escape',
                    'Not using shoulder pressure',
                    'Allowing opponent to escape the trapped arm',
                    'Losing position while setting up choke'
                ],
                variations: ['D\'arce from front headlock', 'D\'arce from guard pass', 'Standing D\'arce'],
                origin: 'turtle'
            },
            {
                id: 'peruvian-necktie',
                name: 'Peruvian Necktie',
                fromId: 'turtle',
                category: 'submission',
                difficulty: 'advanced',
                offsetX: 550,
                offsetY: 0,
                gi: true,
                nogi: true,
                gifUrl: null,
                steps: [
                    'From top of turtle, establish front headlock control',
                    'Trap opponent\'s near arm across their own neck',
                    'Thread your arm under their trapped arm and around neck',
                    'Roll opponent over while maintaining arm trap',
                    'Land with opponent on their side or back',
                    'Thread your leg over opponent\'s body and lock triangle',
                    'Squeeze with arms and legs while arching back'
                ],
                keyPoints: [
                    'Opponent\'s own arm creates part of the choke',
                    'Deep arm placement is essential',
                    'Timing the roll is critical',
                    'Triangle lock adds extra pressure',
                    'Combination of arm choke and leg pressure',
                    'Arch your back to tighten'
                ],
                commonMistakes: [
                    'Not trapping opponent\'s arm properly',
                    'Shallow arm position on neck',
                    'Poor timing on the roll',
                    'Not securing triangle lock',
                    'Losing control during transition',
                    'Not arching back to finish'
                ],
                variations: ['Modified Peruvian without triangle', 'Peruvian from standing', 'Peruvian to back take'],
                origin: 'turtle'
            }
        ];
    </script>
    <script>
        // Wait for D3 to load
        window.addEventListener('load', function() {
            if (typeof d3 === 'undefined') {
                console.error('D3.js failed to load');
                return;
            }
            
            // State
            // State
        let currentFilter = 'basic';
        let activeCategories = new Set(['escape', 'counter', 'submission', 'sweep', 'pass', 'takedown']); // All active by default
        let svg, g;
        
        // Initialize
        function init() {
            createDiagram();
            setupFilters();
            setupBackButtons();
        }
        
        // Setup back buttons
        function setupBackButtons() {
            document.getElementById('position-back-btn').addEventListener('click', showDiagram);
            document.getElementById('technique-back-btn').addEventListener('click', showDiagram);
        }
        
        // Create D3 Diagram
        function createDiagram() {
            const container = document.getElementById('diagram-container');
            const width = container.clientWidth;
            const height = 3850;
            
            svg = d3.select('#flow-diagram')
                .attr('width', width)
                .attr('height', height);
            
            // Add zoom behavior
            const zoom = d3.zoom()
                .scaleExtent([0.1, 4])  // Allow zoom from 10% to 400%
                .on('zoom', (event) => {
                    g.attr('transform', event.transform);
                });
            
            svg.call(zoom);
            
            g = svg.append('g')
                .attr('transform', `translate(${width/2}, 50)`);
            
            // Set initial zoom transform
            svg.call(zoom.transform, d3.zoomIdentity.translate(width/2, 50));
            
            // Add zoom controls
            addZoomControls(zoom);
            
            updateDiagram();
        }
        
        // Add zoom control buttons
        function addZoomControls(zoom) {
            const container = d3.select('#diagram-container');
            
            // Remove any existing zoom controls first
            container.selectAll('.zoom-controls').remove();
            
            // Create zoom controls container
            const controls = container.append('div')
                .attr('class', 'zoom-controls')
                .style('position', 'absolute')
                .style('top', '20px')
                .style('left', '20px')
                .style('display', 'flex')
                .style('flex-direction', 'column')
                .style('gap', '8px')
                .style('z-index', '1000');
            
            // Zoom in button
            controls.append('button')
                .attr('class', 'zoom-btn')
                .html('➕')
                .style('width', '40px')
                .style('height', '40px')
                .style('background', 'white')
                .style('border', '2px solid var(--border-color)')
                .style('color', 'var(--text-primary)')
                .style('border-radius', '8px')
                .style('cursor', 'pointer')
                .style('font-size', '18px')
                .style('display', 'flex')
                .style('align-items', 'center')
                .style('justify-content', 'center')
                .style('box-shadow', '0 2px 8px rgba(0,0,0,0.08)')
                .on('click', () => {
                    svg.transition().duration(300).call(zoom.scaleBy, 1.3);
                })
                .on('mouseenter', function() {
                    d3.select(this).style('border-color', 'var(--accent-gold)');
                })
                .on('mouseleave', function() {
                    d3.select(this).style('border-color', 'var(--border-color)');
                });
            
            // Zoom out button
            controls.append('button')
                .attr('class', 'zoom-btn')
                .html('➖')
                .style('width', '40px')
                .style('height', '40px')
                .style('background', 'white')
                .style('border', '2px solid var(--border-color)')
                .style('color', 'var(--text-primary)')
                .style('border-radius', '8px')
                .style('cursor', 'pointer')
                .style('font-size', '18px')
                .style('display', 'flex')
                .style('align-items', 'center')
                .style('justify-content', 'center')
                .style('box-shadow', '0 2px 8px rgba(0,0,0,0.08)')
                .on('click', () => {
                    svg.transition().duration(300).call(zoom.scaleBy, 0.7);
                })
                .on('mouseenter', function() {
                    d3.select(this).style('border-color', 'var(--accent-gold)');
                })
                .on('mouseleave', function() {
                    d3.select(this).style('border-color', 'var(--border-color)');
                });
            
            // Reset zoom button
            controls.append('button')
                .attr('class', 'zoom-btn')
                .html('⟲')
                .style('width', '40px')
                .style('height', '40px')
                .style('background', 'white')
                .style('border', '2px solid var(--border-color)')
                .style('color', 'var(--text-primary)')
                .style('border-radius', '8px')
                .style('cursor', 'pointer')
                .style('font-size', '20px')
                .style('display', 'flex')
                .style('align-items', 'center')
                .style('justify-content', 'center')
                .style('box-shadow', '0 2px 8px rgba(0,0,0,0.08)')
                .on('click', () => {
                    const container = document.getElementById('diagram-container');
                    const width = container.clientWidth;
                    svg.transition().duration(500).call(
                        zoom.transform,
                        d3.zoomIdentity.translate(width/2, 50)
                    );
                })
                .on('mouseenter', function() {
                    d3.select(this).style('border-color', 'var(--accent-gold)');
                })
                .on('mouseleave', function() {
                    d3.select(this).style('border-color', 'var(--border-color)');
                });
        }
        
        // Calculate dynamic position spacing based on visible techniques
        function calculateDynamicPositionSpacing(positions, techniques) {
            const minGap = 100; // Minimum gap between position centers
            const techniqueHeight = 80;
            const spacing = 10;
            
            const updatedPositions = [];
            
            // Start from the first position's original Y if it exists
            let currentY = positions.length > 0 ? positions[0].y : 100;
            
            positions.forEach((position, index) => {
                // Create a copy with updated Y
                const updatedPosition = { ...position, y: currentY };
                updatedPositions.push(updatedPosition);
                
                if (index < positions.length - 1) {
                    // Get the maximum column height for current position
                    const currentMaxHeight = getMaxColumnHeight(position.id, techniques, techniqueHeight, spacing);
                    
                    // Get the maximum column height for next position
                    const nextPosition = positions[index + 1];
                    const nextMaxHeight = getMaxColumnHeight(nextPosition.id, techniques, techniqueHeight, spacing);
                    
                    // Space needed = half of current tallest column + minGap + half of next tallest column
                    const spaceNeeded = (currentMaxHeight / 2) + minGap + (nextMaxHeight / 2);
                    
                    currentY += spaceNeeded;
                }
            });
            
            return updatedPositions;
        }
        
        // Get the maximum column height for any single column of techniques
        function getMaxColumnHeight(positionId, techniques, techniqueHeight, spacing) {
            // Get all techniques for this position
            const positionTechs = techniques.filter(t => t.fromId === positionId);
            
            if (positionTechs.length === 0) return 80; // Just the position node
            
            const maxPerColumn = 6; // Must match the layout logic
            
            // Group by difficulty and side
            const groups = {};
            positionTechs.forEach(tech => {
                const side = (tech.category === 'escape' || tech.category === 'pass') ? 'left' : 'right';
                const key = `${side}-${tech.difficulty}`;
                if (!groups[key]) groups[key] = [];
                groups[key].push(tech);
            });
            
            // Find the tallest actual column (max 6 techniques)
            let maxColumnTechniques = 0;
            Object.values(groups).forEach(groupTechs => {
                // Each group can have multiple columns of max 6
                const techsPerColumn = Math.min(groupTechs.length, maxPerColumn);
                if (techsPerColumn > maxColumnTechniques) {
                    maxColumnTechniques = techsPerColumn;
                }
            });
            
            // Calculate height of tallest column
            if (maxColumnTechniques === 0) return 80;
            
            const totalHeight = (maxColumnTechniques * techniqueHeight) + ((maxColumnTechniques - 1) * spacing);
            return totalHeight;
        }
        
        function calculatePositionHeight(positionId, techniques, techniqueHeight, spacing) {
            // This is the same as getMaxColumnHeight - keeping for compatibility
            return getMaxColumnHeight(positionId, techniques, techniqueHeight, spacing);
        }
        
        function groupByDifficulty(techniques) {
            return {
                basic: techniques.filter(t => t.difficulty === 'basic'),
                intermediate: techniques.filter(t => t.difficulty === 'intermediate'),
                advanced: techniques.filter(t => t.difficulty === 'advanced')
            };
        }
        
        function updateDiagram() {
            const container = document.getElementById('diagram-container');
            const width = container.clientWidth;
            
            // Filter positions by difficulty (cumulative)
            let filteredPositions;
            if (currentFilter === 'basic') {
                filteredPositions = positionsData.filter(p => p.difficulty === 'basic');
            } else if (currentFilter === 'intermediate') {
                filteredPositions = positionsData.filter(p => 
                    p.difficulty === 'basic' || p.difficulty === 'intermediate'
                );
            } else if (currentFilter === 'advanced') {
                filteredPositions = positionsData; // Show all positions
            }
            
            // Filter techniques by difficulty (cumulative)
            let filteredTechniques;
            if (currentFilter === 'basic') {
                filteredTechniques = techniquesData.filter(t => t.difficulty === 'basic');
            } else if (currentFilter === 'intermediate') {
                filteredTechniques = techniquesData.filter(t => 
                    t.difficulty === 'basic' || t.difficulty === 'intermediate'
                );
            } else if (currentFilter === 'advanced') {
                filteredTechniques = techniquesData; // Show all techniques
            }
            
            // Further filter by active categories
            filteredTechniques = filteredTechniques.filter(t => activeCategories.has(t.category));
            
            // Calculate dynamic position spacing based on visible techniques
            const dynamicPositions = calculateDynamicPositionSpacing(filteredPositions, filteredTechniques);
            
            // Update SVG height based on last position
            const lastPosition = dynamicPositions[dynamicPositions.length - 1];
            const lastPositionHeight = calculatePositionHeight(lastPosition.id, filteredTechniques, 80, 10);
            const totalHeight = lastPosition.y + (lastPositionHeight / 2) + 300;
            
            svg.transition()
                .duration(500)
                .attr('height', totalHeight);
            
            // Group techniques by position AND offsetX (to handle multiple columns)
            const techniquesByPosition = {};
            const techniqueToTechnique = []; // For techniques that connect to other techniques
            
            filteredTechniques.forEach(tech => {
                const position = dynamicPositions.find(p => p.id === tech.fromId);
                
                if (position) {
                    // This technique connects to a position
                    if (!techniquesByPosition[tech.fromId]) {
                        techniquesByPosition[tech.fromId] = {};
                    }
                    
                    // Group by exact offsetX value to handle multiple columns per side
                    const columnKey = tech.offsetX;
                    if (!techniquesByPosition[tech.fromId][columnKey]) {
                        techniquesByPosition[tech.fromId][columnKey] = [];
                    }
                    techniquesByPosition[tech.fromId][columnKey].push(tech);
                } else {
                    // This technique connects to another technique (e.g., submission escape)
                    techniqueToTechnique.push(tech);
                }
            });
            
            // Sort techniques within each column by their original offsetY
            Object.keys(techniquesByPosition).forEach(posId => {
                Object.keys(techniquesByPosition[posId]).forEach(columnKey => {
                    techniquesByPosition[posId][columnKey].sort((a, b) => a.offsetY - b.offsetY);
                });
            });
            
            // Calculate adjusted positions for techniques to prevent overlap
            const adjustedTechniques = [];
            const techniqueHeight = 80; // Height of technique box + spacing
            const maxPerColumn = 6; // Maximum techniques per column
            const columnSpacing = 180; // Horizontal spacing between columns
            
            Object.keys(techniquesByPosition).forEach(posId => {
                const position = dynamicPositions.find(p => p.id === posId);
                if (!position) return;
                
                // Collect all techniques for this position, grouped by difficulty, side, and category
                const leftTechs = { 
                    basic: { escape: [], pass: [] },
                    intermediate: { escape: [], pass: [] },
                    advanced: { escape: [], pass: [] }
                };
                const rightTechs = { 
                    basic: { submission: [], sweep: [], takedown: [] },
                    intermediate: { submission: [], sweep: [], takedown: [] },
                    advanced: { submission: [], sweep: [], takedown: [] }
                };
                
                Object.keys(techniquesByPosition[posId]).forEach(columnKey => {
                    const techs = techniquesByPosition[posId][columnKey];
                    if (techs.length === 0) return;
                    
                    techs.forEach(tech => {
                        const side = tech.category === 'escape' || tech.category === 'pass' ? 'left' : 'right';
                        const difficulty = tech.difficulty;
                        const category = tech.category;
                        
                        if (side === 'left') {
                            if (leftTechs[difficulty][category]) {
                                leftTechs[difficulty][category].push(tech);
                            }
                        } else {
                            if (rightTechs[difficulty][category]) {
                                rightTechs[difficulty][category].push(tech);
                            }
                        }
                    });
                });
                
                // Layout LEFT side (escapes, passes)
                // Order: Basic Escapes, Basic Passes, Intermediate Escapes, Intermediate Passes, Advanced Escapes, Advanced Passes
                let leftColumnIndex = 0;
                
                ['basic', 'intermediate', 'advanced'].forEach(difficulty => {
                    ['escape', 'pass'].forEach(category => {
                        const techs = leftTechs[difficulty][category];
                        if (techs.length === 0) return;
                        
                        // Split into chunks of maxPerColumn
                        for (let i = 0; i < techs.length; i += maxPerColumn) {
                            const columnTechs = techs.slice(i, Math.min(i + maxPerColumn, techs.length));
                            
                            // Calculate offsetX: first column at -250, next at -430, etc.
                            const columnOffsetX = -250 - (leftColumnIndex * columnSpacing);
                            leftColumnIndex++;
                            
                            // Center this column's techniques vertically
                            const columnHeight = (columnTechs.length - 1) * techniqueHeight;
                            const startY = position.y - (columnHeight / 2);
                            
                            columnTechs.forEach((tech, idx) => {
                                adjustedTechniques.push({
                                    ...tech,
                                    adjustedX: columnOffsetX,
                                    adjustedY: startY + (idx * techniqueHeight),
                                    positionY: position.y
                                });
                            });
                        }
                    });
                });
                
                // Layout RIGHT side (submissions, sweeps, takedowns) WITH DYNAMIC COUNTER SPACING
                // We need to handle each column of techniques and calculate counter space for that column
                let globalRightColumnIndex = 0; // Tracks the actual X position
                
                ['basic', 'intermediate', 'advanced'].forEach(difficulty => {
                    ['submission', 'sweep', 'takedown'].forEach(category => {
                        const techs = rightTechs[difficulty][category];
                        if (techs.length === 0) return;
                        
                        // Split into chunks of maxPerColumn (each chunk is a "technique column")
                        for (let i = 0; i < techs.length; i += maxPerColumn) {
                            const columnTechs = techs.slice(i, Math.min(i + maxPerColumn, techs.length));
                            
                            // For submissions, calculate how many counter columns this technique column needs
                            let numCounterColumns = 0;
                            if (category === 'submission') {
                                // Count TOTAL counters for ALL submissions in this column
                                let totalCounters = 0;
                                columnTechs.forEach(submission => {
                                    const counters = techniqueToTechnique.filter(t => t.fromId === submission.id);
                                    totalCounters += counters.length;
                                });
                                // Calculate how many columns needed for all these counters (max 6 per column)
                                numCounterColumns = Math.ceil(totalCounters / maxPerColumn);
                            }
                            
                            // Calculate base position for this technique column
                            const baseOffsetX = 250 + (globalRightColumnIndex * columnSpacing);
                            
                            // Add space for counter columns (each counter column needs columnSpacing)
                            const counterSpace = numCounterColumns * columnSpacing;
                            const techniqueOffsetX = baseOffsetX + counterSpace;
                            
                            // Update global column index to account for counter columns + this technique column
                            globalRightColumnIndex += numCounterColumns + 1;
                            
                            // Center this column's techniques vertically
                            const columnHeight = (columnTechs.length - 1) * techniqueHeight;
                            const startY = position.y - (columnHeight / 2);
                            
                            columnTechs.forEach((tech, idx) => {
                                adjustedTechniques.push({
                                    ...tech,
                                    adjustedX: techniqueOffsetX,
                                    adjustedY: startY + (idx * techniqueHeight),
                                    positionY: position.y,
                                    counterColumns: numCounterColumns // Store for counter positioning
                                });
                            });
                        }
                    });
                });
            });
            
            // Now position technique-to-technique connections (counters)
            // Counters need to:
            // 1. Stay near their parent submission vertically
            // 2. Stack vertically if a submission has multiple counters
            // 3. Share column space (max 6 per column) across all submissions
            // 4. Not overlap with counters from other submissions
            
            // First, group submissions by their column position
            const submissionsByColumn = {};
            adjustedTechniques.forEach(tech => {
                if (tech.category === 'submission' && tech.counterColumns > 0) {
                    const columnKey = tech.adjustedX;
                    if (!submissionsByColumn[columnKey]) {
                        submissionsByColumn[columnKey] = [];
                    }
                    submissionsByColumn[columnKey].push(tech);
                }
            });
            
            // For each submission column, place all counters
            Object.values(submissionsByColumn).forEach(submissions => {
                // Track occupied Y ranges in each counter column to prevent overlaps
                // Structure: counterColumnOccupied[columnIndex] = [{startY, endY}, ...]
                const counterColumnOccupied = {};
                
                // Initialize occupied ranges for each counter column
                const numReservedColumns = submissions[0]?.counterColumns || 0;
                for (let i = 0; i < numReservedColumns; i++) {
                    counterColumnOccupied[i] = [];
                }
                
                // Process each submission in order
                submissions.forEach(submission => {
                    const counters = techniqueToTechnique.filter(t => t.fromId === submission.id);
                    if (counters.length === 0) return;
                    
                    // Find the first counter column that can fit all of this submission's counters
                    let targetCounterColumn = -1;
                    const submissionStartY = submission.adjustedY;
                    const submissionEndY = submissionStartY + (counters.length * techniqueHeight);
                    
                    for (let col = 0; col < numReservedColumns; col++) {
                        // Check if this Y range overlaps with any occupied ranges in this column
                        const occupied = counterColumnOccupied[col] || [];
                        const hasOverlap = occupied.some(range => 
                            !(submissionEndY <= range.startY || submissionStartY >= range.endY)
                        );
                        
                        if (!hasOverlap) {
                            targetCounterColumn = col;
                            break;
                        }
                    }
                    
                    // If we found a column, place the counters there
                    if (targetCounterColumn >= 0) {
                        // Center counters vertically around the submission
                        const totalCounterHeight = (counters.length - 1) * techniqueHeight;
                        const centerOffset = -totalCounterHeight / 2;
                        
                        counters.forEach((counter, counterIndex) => {
                            // Calculate X position in the target counter column
                            const counterOffsetX = submission.adjustedX - (numReservedColumns * columnSpacing) + (targetCounterColumn * columnSpacing);
                            
                            // Center counters around the submission's Y position
                            const counterOffsetY = submission.adjustedY + centerOffset + (counterIndex * techniqueHeight);
                            
                            adjustedTechniques.push({
                                ...counter,
                                adjustedX: counterOffsetX,
                                adjustedY: counterOffsetY,
                                positionY: submission.positionY
                            });
                        });
                        
                        // Mark this Y range as occupied in this counter column
                        if (!counterColumnOccupied[targetCounterColumn]) {
                            counterColumnOccupied[targetCounterColumn] = [];
                        }
                        counterColumnOccupied[targetCounterColumn].push({
                            startY: submissionStartY + centerOffset,
                            endY: submissionEndY + centerOffset
                        });
                    }
                });
            });
            
            // Create links using adjusted positions
            const links = adjustedTechniques.map(tech => {
                // Check if fromId is a position
                const position = dynamicPositions.find(p => p.id === tech.fromId);
                
                if (position) {
                    // Link from position to technique
                    return {
                        id: tech.id,
                        source: { x: 0, y: position.y },
                        target: { x: tech.adjustedX, y: tech.adjustedY },
                        category: tech.category
                    };
                } else {
                    // Link from technique to technique (e.g., submission escape)
                    const sourceTechnique = adjustedTechniques.find(t => t.id === tech.fromId);
                    if (!sourceTechnique) return null;
                    
                    return {
                        id: tech.id,
                        source: { x: sourceTechnique.adjustedX, y: sourceTechnique.adjustedY },
                        target: { x: tech.adjustedX, y: tech.adjustedY },
                        category: tech.category
                    };
                }
            }).filter(l => l !== null);
            
            // Update or create links with transitions
            const linkSelection = g.selectAll('.link')
                .data(links, d => d.id); // Key by technique ID
            
            // Remove old links - fade out
            linkSelection.exit()
                .transition()
                .duration(300)
                .style('opacity', 0)
                .remove();
            
            // Add new links - fade in
            const linkEnter = linkSelection.enter()
                .append('path')
                .attr('class', 'link')
                .attr('d', d => {
                    const dx = d.target.x - d.source.x;
                    const dy = d.target.y - d.source.y;
                    const dr = Math.sqrt(dx * dx + dy * dy) * 0.7;
                    return `M${d.source.x},${d.source.y}A${dr},${dr} 0 0,1 ${d.target.x},${d.target.y}`;
                })
                .attr('stroke', d => getCategoryColor(d.category))
                .style('opacity', 0)
                .lower() // Move to back
                .transition()
                .duration(300)
                .style('opacity', 1);
            
            // Update existing links - just update path smoothly as positions move
            linkSelection
                .lower() // Keep existing links in back too
                .transition()
                .duration(500)
                .attr('d', d => {
                    const dx = d.target.x - d.source.x;
                    const dy = d.target.y - d.source.y;
                    const dr = Math.sqrt(dx * dx + dy * dy) * 0.7;
                    return `M${d.source.x},${d.source.y}A${dr},${dr} 0 0,1 ${d.target.x},${d.target.y}`;
                });
            
            // Update or create position nodes with transitions
            const positionSelection = g.selectAll('.position-node')
                .data(dynamicPositions, d => d.id);
            
            // Remove old positions
            positionSelection.exit()
                .transition()
                .duration(500)
                .style('opacity', 0)
                .remove();
            
            // Add new positions
            const positionEnter = positionSelection.enter()
                .append('g')
                .attr('class', 'node position-node')
                .attr('transform', d => `translate(0, ${d.y})`)
                .style('opacity', 0)
                .on('click', (event, d) => showPositionDetail(d));
            
            // Create octagon path (8 sided polygon)
            const octagonPath = (radius) => {
                const points = [];
                for (let i = 0; i < 8; i++) {
                    const angle = (i * Math.PI / 4) - (Math.PI / 8);
                    const x = radius * Math.cos(angle);
                    const y = radius * Math.sin(angle);
                    points.push(`${x},${y}`);
                }
                return `M${points.join('L')}Z`;
            };
            
            positionEnter.append('path')
                .attr('class', 'node-octagon')
                .attr('d', octagonPath(40))
                .attr('fill', 'var(--color-position)')
                .attr('stroke', 'var(--color-position)')
                .attr('stroke-width', 5);
            
            positionEnter.append('text')
                .attr('class', 'node-text position-text')
                .attr('y', 5)
                .text(d => d.name)
                .call(wrap, 70);
            
            // Update all positions (existing + new)
            positionEnter.merge(positionSelection)
                .transition()
                .duration(500)
                .attr('transform', d => `translate(0, ${d.y})`)
                .style('opacity', 1);
            
            // Update or create technique nodes with transitions
            const techniqueSelection = g.selectAll('.technique-node')
                .data(adjustedTechniques, d => d.id);
            
            // Remove old techniques
            techniqueSelection.exit()
                .transition()
                .duration(500)
                .style('opacity', 0)
                .remove();
            
            // Add new techniques
            const techniqueEnter = techniqueSelection.enter()
                .append('g')
                .attr('class', 'node technique-node')
                .attr('data-category', d => d.category)
                .attr('transform', d => `translate(${d.adjustedX}, ${d.adjustedY})`)
                .style('opacity', 0)
                .on('click', (event, d) => showTechniqueDetail(d));
            
            techniqueEnter.append('rect')
                .attr('class', 'node-rect')
                .attr('x', -60)
                .attr('y', -30)
                .attr('width', 120)
                .attr('height', 60)
                .attr('fill', 'white')
                .attr('stroke', d => getCategoryColor(d.category))
                .attr('stroke-width', 4);
            
            techniqueEnter.append('text')
                .attr('class', 'node-text')
                .attr('y', -5)
                .text(d => d.name)
                .call(wrap, 110);
            
            // Difficulty badges
            techniqueEnter.append('circle')
                .attr('cx', 45)
                .attr('cy', -20)
                .attr('r', 12)
                .attr('fill', '#fff')
                .attr('stroke', d => {
                    if (d.difficulty === 'basic') return '#9DB54D';
                    if (d.difficulty === 'intermediate') return '#F6A623';
                    return '#C75B5C';
                })
                .attr('stroke-width', 4);
            
            techniqueEnter.append('text')
                .attr('class', 'difficulty-badge')
                .attr('x', 45)
                .attr('y', -16)
                .attr('fill', d => {
                    if (d.difficulty === 'basic') return '#9DB54D';
                    if (d.difficulty === 'intermediate') return '#F6A623';
                    return '#C75B5C';
                })
                .text(d => d.difficulty.charAt(0).toUpperCase());
            
            // Update all techniques (existing + new)
            techniqueEnter.merge(techniqueSelection)
                .transition()
                .duration(500)
                .attr('transform', d => `translate(${d.adjustedX}, ${d.adjustedY})`)
                .style('opacity', 1);
        }
        
        // Text wrapping function
        function wrap(text, width) {
            text.each(function() {
                const text = d3.select(this);
                const words = text.text().split(/\s+/).reverse();
                let word;
                let line = [];
                let lineNumber = 0;
                const lineHeight = 1.1;
                const y = text.attr('y');
                const dy = 0;
                let tspan = text.text(null).append('tspan').attr('x', 0).attr('y', y).attr('dy', dy + 'em');
                
                while (word = words.pop()) {
                    line.push(word);
                    tspan.text(line.join(' '));
                    if (tspan.node().getComputedTextLength() > width) {
                        line.pop();
                        tspan.text(line.join(' '));
                        line = [word];
                        tspan = text.append('tspan').attr('x', 0).attr('y', y).attr('dy', ++lineNumber * lineHeight + dy + 'em').text(word);
                    }
                }
            });
        }
        
        // Get category color
        function getCategoryColor(category) {
            const colors = {
                position: 'var(--color-position)',
                escape: 'var(--color-escape)',
                counter: 'var(--color-counter)',
                submission: 'var(--color-submission)',
                sweep: 'var(--color-sweep)',
                pass: 'var(--color-pass)',
                takedown: 'var(--color-takedown)'
            };
            return colors[category] || '#888';
        }
        
        // Setup filters
        function setupFilters() {
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentFilter = btn.dataset.filter;
                    
                    // If we're in a detail view, return to diagram
                    if (document.getElementById('position-detail').classList.contains('active') ||
                        document.getElementById('technique-detail').classList.contains('active')) {
                        showDiagram();
                    }
                    
                    updateDiagram();
                });
            });
            
            // Setup category toggles
            document.querySelectorAll('.category-toggle').forEach(btn => {
                btn.addEventListener('click', () => {
                    const category = btn.dataset.category;
                    
                    // Toggle the category
                    if (activeCategories.has(category)) {
                        activeCategories.delete(category);
                        btn.classList.remove('active');
                    } else {
                        activeCategories.add(category);
                        btn.classList.add('active');
                    }
                    
                    // If we're in a detail view, return to diagram
                    if (document.getElementById('position-detail').classList.contains('active') ||
                        document.getElementById('technique-detail').classList.contains('active')) {
                        showDiagram();
                    }
                    
                    updateDiagram();
                });
            });
        }
        
        // Show position detail
        function showPositionDetail(position) {
            document.getElementById('diagram-container').style.display = 'none';
            document.getElementById('position-detail').classList.add('active');
            document.getElementById('technique-detail').classList.remove('active');
            document.querySelector('.legend').style.display = 'none';
            
            document.getElementById('position-name').textContent = position.name;
            document.getElementById('position-description').textContent = position.description;
            
            const gifContainer = document.getElementById('position-gif');
            gifContainer.innerHTML = position.gifUrl 
                ? `<img src="${position.gifUrl}" alt="${position.name}">` 
                : '<div class="gif-placeholder">Demonstration video placeholder</div>';
            
            document.getElementById('position-objectives').innerHTML = 
                position.objectives.map(obj => `<li>${obj}</li>`).join('');
            document.getElementById('position-keypoints').innerHTML = 
                position.keyPoints.map(kp => `<li>${kp}</li>`).join('');
            document.getElementById('position-mistakes').innerHTML = 
                position.commonMistakes.map(cm => `<li>${cm}</li>`).join('');
        }
        
        // Show technique detail
        function showTechniqueDetail(technique) {
            document.getElementById('diagram-container').style.display = 'none';
            document.getElementById('technique-detail').classList.add('active');
            document.getElementById('position-detail').classList.remove('active');
            document.querySelector('.legend').style.display = 'none';
            
            document.getElementById('technique-name').textContent = technique.name;
            document.getElementById('technique-category').textContent = technique.category;
            document.getElementById('technique-difficulty').textContent = technique.difficulty;
            document.getElementById('technique-origin').textContent = `From ${technique.origin}`;
            
            const gifContainer = document.getElementById('technique-gif');
            gifContainer.innerHTML = technique.gifUrl 
                ? `<img src="${technique.gifUrl}" alt="${technique.name}">` 
                : '<div class="gif-placeholder">Demonstration video placeholder</div>';
            
            document.getElementById('technique-steps').innerHTML = 
                technique.steps.map(step => `<li>${step}</li>`).join('');
            document.getElementById('technique-keypoints').innerHTML = 
                technique.keyPoints.map(kp => `<li>${kp}</li>`).join('');
            document.getElementById('technique-mistakes').innerHTML = 
                technique.commonMistakes.map(cm => `<li>${cm}</li>`).join('');
            document.getElementById('technique-variations').innerHTML = 
                technique.variations.map(v => `<li>${v}</li>`).join('');
        }
        
        // Show diagram
        function showDiagram() {
            document.getElementById('diagram-container').style.display = 'block';
            document.getElementById('position-detail').classList.remove('active');
            document.getElementById('technique-detail').classList.remove('active');
            document.querySelector('.legend').style.display = 'block';
        }
        
        // Handle window resize
        window.addEventListener('resize', () => {
            const container = document.getElementById('diagram-container');
            const width = container.clientWidth;
            svg.attr('width', width);
            g.attr('transform', `translate(${width/2}, 50)`);
            updateDiagram();
        });
        
        // Initialize on load
        init();
        });
    </script>
</body>
</html>
